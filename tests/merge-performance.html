<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åˆå¹¶å•å…ƒæ ¼æ€§èƒ½æµ‹è¯• - WorkfineSheet</title>
  <style>
    :root { --primary: #4facfe; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f7fa; min-height: 100vh; }
    .navbar { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 16px 24px; display: flex; align-items: center; gap: 16px; }
    .navbar a { color: white; text-decoration: none; opacity: 0.8; }
    .navbar a:hover { opacity: 1; }
    .navbar h1 { font-size: 1.25rem; flex: 1; }
    .container { max-width: 1400px; margin: 0 auto; padding: 24px; }
    .intro { background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .intro h2 { color: #1f2937; margin-bottom: 12px; }
    .intro p { color: #6b7280; line-height: 1.6; }
    .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin: 20px 0; }
    .metric-card { background: #f9fafb; border-radius: 8px; padding: 16px; text-align: center; }
    .metric-card .value { font-size: 1.5rem; font-weight: 700; color: #4facfe; }
    .metric-card .label { font-size: 0.875rem; color: #6b7280; margin-top: 4px; }
    .test-section { background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .test-section h3 { color: #1f2937; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
    .test-section .desc { color: #6b7280; font-size: 0.9rem; margin-bottom: 16px; }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 16px; }
    button { padding: 10px 20px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 500; transition: transform 0.2s, box-shadow 0.2s; }
    button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4); }
    button.secondary { background: #e5e7eb; color: #374151; }
    button.extreme { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
    .result { background: #f9fafb; border-radius: 8px; padding: 16px; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85rem; line-height: 1.8; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
    .result:empty::before { content: 'ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...'; color: #9ca3af; }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }
    .badge.fast { background: #d1fae5; color: #065f46; }
    .badge.medium { background: #fef3c7; color: #92400e; }
    .badge.slow { background: #fee2e2; color: #991b1b; }
    .progress { width: 100%; height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden; margin: 10px 0; }
    .progress-bar { height: 100%; background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%); width: 0%; transition: width 0.3s ease; }
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="index.html">â† è¿”å›</a>
    <h1>ğŸ”— åˆå¹¶å•å…ƒæ ¼æ€§èƒ½æµ‹è¯•</h1>
  </nav>
  
  <div class="container">
    <div class="intro">
      <h2>åˆå¹¶å•å…ƒæ ¼æ€§èƒ½æµ‹è¯•</h2>
      <p>æµ‹è¯• SheetModel åˆå¹¶å•å…ƒæ ¼ç³»ç»Ÿçš„æ“ä½œæ€§èƒ½ï¼ŒåŒ…æ‹¬åˆå¹¶ã€å–æ¶ˆåˆå¹¶ã€çŠ¶æ€æŸ¥è¯¢ã€è¾¹æ¡†å¤„ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚</p>
      
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="value" id="metricMergeRate">--</div>
          <div class="label">åˆå¹¶æ“ä½œ/ç§’</div>
        </div>
        <div class="metric-card">
          <div class="value" id="metricUnmergeRate">--</div>
          <div class="label">å–æ¶ˆåˆå¹¶/ç§’</div>
        </div>
        <div class="metric-card">
          <div class="value" id="metricQueryRate">--</div>
          <div class="label">çŠ¶æ€æŸ¥è¯¢/ç§’</div>
        </div>
        <div class="metric-card">
          <div class="value" id="metricRegionCount">--</div>
          <div class="label">åˆå¹¶åŒºåŸŸæ•°</div>
        </div>
      </div>
    </div>
    
    <!-- åˆå¹¶æ“ä½œæµ‹è¯• -->
    <div class="test-section">
      <h3>ğŸ”— æµ‹è¯• 1: æ‰¹é‡åˆå¹¶æ“ä½œ</h3>
      <p class="desc">æµ‹è¯• SheetModel.mergeCells æ‰¹é‡åˆå¹¶çš„æ€§èƒ½</p>
      <div class="controls">
        <button onclick="testMerge(100)">100 ä¸ªåŒºåŸŸ</button>
        <button onclick="testMerge(500)">500 ä¸ªåŒºåŸŸ</button>
        <button onclick="testMerge(1000)">1,000 ä¸ªåŒºåŸŸ</button>
        <button onclick="testMerge(2000)" class="extreme">âš¡ 2,000 ä¸ªåŒºåŸŸ</button>
      </div>
      <div id="result1" class="result"></div>
    </div>
    
    <!-- å–æ¶ˆåˆå¹¶æµ‹è¯• -->
    <div class="test-section">
      <h3>âœ‚ï¸ æµ‹è¯• 2: æ‰¹é‡å–æ¶ˆåˆå¹¶</h3>
      <p class="desc">æµ‹è¯• unmergeCells æ‰¹é‡å–æ¶ˆåˆå¹¶çš„æ€§èƒ½</p>
      <div class="controls">
        <button onclick="testUnmerge(100)">100 ä¸ªåŒºåŸŸ</button>
        <button onclick="testUnmerge(500)">500 ä¸ªåŒºåŸŸ</button>
        <button onclick="testUnmerge(1000)">1,000 ä¸ªåŒºåŸŸ</button>
        <button onclick="testUnmerge(2000)" class="extreme">ğŸ”¥ 2,000 ä¸ªåŒºåŸŸ</button>
      </div>
      <div id="result2" class="result"></div>
    </div>
    
    <!-- çŠ¶æ€æŸ¥è¯¢æµ‹è¯• -->
    <div class="test-section">
      <h3>ğŸ” æµ‹è¯• 3: åˆå¹¶çŠ¶æ€æŸ¥è¯¢</h3>
      <p class="desc">æµ‹è¯• getMergedRegionã€isMergedCellã€getMergedCellInfo çš„æŸ¥è¯¢æ€§èƒ½</p>
      <div class="controls">
        <button onclick="testMergeQuery(5000)">5,000 æ¬¡</button>
        <button onclick="testMergeQuery(20000)">20,000 æ¬¡</button>
        <button onclick="testMergeQuery(50000)">50,000 æ¬¡</button>
        <button onclick="testMergeQuery(100000)" class="extreme">100K æ¬¡</button>
      </div>
      <div id="result3" class="result"></div>
    </div>
    
    <!-- å¤§åŒºåŸŸåˆå¹¶æµ‹è¯• -->
    <div class="test-section">
      <h3>ğŸ“ æµ‹è¯• 4: å¤§åŒºåŸŸåˆå¹¶</h3>
      <p class="desc">æµ‹è¯•åˆå¹¶å¤§èŒƒå›´å•å…ƒæ ¼çš„æ€§èƒ½</p>
      <div class="controls">
        <button onclick="testLargeMerge(10, 10)">10Ã—10</button>
        <button onclick="testLargeMerge(50, 50)">50Ã—50</button>
        <button onclick="testLargeMerge(100, 100)">100Ã—100</button>
        <button onclick="testLargeMerge(200, 200)" class="extreme">200Ã—200</button>
      </div>
      <div id="result4" class="result"></div>
    </div>
    
    <!-- è¾¹æ¡†å¤„ç†æµ‹è¯• -->
    <div class="test-section">
      <h3>ğŸ“Š æµ‹è¯• 5: åˆå¹¶æ—¶è¾¹æ¡†å¤„ç†</h3>
      <p class="desc">æµ‹è¯•åˆå¹¶/å–æ¶ˆåˆå¹¶æ—¶è¾¹æ¡†æ”¶é›†å’Œåˆ†å‘çš„æ€§èƒ½ (Excel è¡Œä¸º)</p>
      <div class="controls">
        <button onclick="testMergeBorder(100)">100 ä¸ªåŒºåŸŸ</button>
        <button onclick="testMergeBorder(500)">500 ä¸ªåŒºåŸŸ</button>
        <button onclick="testMergeBorder(1000)" class="extreme">1,000 ä¸ªåŒºåŸŸ</button>
      </div>
      <div id="result5" class="result"></div>
    </div>
    
    <!-- canMerge æ£€æŸ¥æµ‹è¯• -->
    <div class="test-section">
      <h3>âœ… æµ‹è¯• 6: canMerge å†²çªæ£€æŸ¥</h3>
      <p class="desc">æµ‹è¯• canMerge æ–¹æ³•æ£€æŸ¥åˆå¹¶åŒºåŸŸå†²çªçš„æ€§èƒ½</p>
      <div class="controls">
        <button onclick="testCanMerge(1000)">1,000 æ¬¡</button>
        <button onclick="testCanMerge(5000)">5,000 æ¬¡</button>
        <button onclick="testCanMerge(10000)">10,000 æ¬¡</button>
        <button onclick="testCanMerge(20000)" class="extreme">20,000 æ¬¡</button>
      </div>
      <div id="result6" class="result"></div>
    </div>
    
    <!-- ç»¼åˆæµ‹è¯• -->
    <div class="test-section">
      <h3>ğŸ”„ æµ‹è¯• 7: åˆå¹¶/å–æ¶ˆåˆå¹¶å¾ªç¯</h3>
      <p class="desc">æµ‹è¯•åå¤åˆå¹¶å’Œå–æ¶ˆåˆå¹¶çš„æ€§èƒ½ç¨³å®šæ€§</p>
      <div class="controls">
        <button onclick="testMergeUnmergeCycle(50, 5)">50 åŒºåŸŸ Ã— 5 è½®</button>
        <button onclick="testMergeUnmergeCycle(100, 10)">100 åŒºåŸŸ Ã— 10 è½®</button>
        <button onclick="testMergeUnmergeCycle(200, 10)" class="extreme">200 åŒºåŸŸ Ã— 10 è½®</button>
      </div>
      <div id="result7" class="result"></div>
    </div>
  </div>

  <script type="module">
    import { SheetModel } from '../src/lib/SheetModel.ts'
    
    function formatTime(ms) {
      if (ms < 0.001) return `${(ms * 1000000).toFixed(2)} ns`
      if (ms < 1) return `${(ms * 1000).toFixed(2)} Î¼s`
      if (ms < 1000) return `${ms.toFixed(2)} ms`
      return `${(ms / 1000).toFixed(2)} s`
    }
    
    function getSpeedClass(ms, thresholds) {
      if (ms < thresholds.fast) return 'fast'
      if (ms < thresholds.medium) return 'medium'
      return 'slow'
    }
    
    // æµ‹è¯• 1: æ‰¹é‡åˆå¹¶
    window.testMerge = async function(count) {
      const resultDiv = document.getElementById('result1')
      resultDiv.innerHTML = 'â³ åˆ›å»º SheetModel å®ä¾‹...'
      
      await new Promise(r => setTimeout(r, 10))
      
      const model = new SheetModel()
      
      // å¡«å……ä¸€äº›æ•°æ®
      for (let r = 0; r < 200; r++) {
        for (let c = 0; c < 200; c++) {
          model.setValue(r, c, `R${r}C${c}`)
        }
      }
      
      resultDiv.innerHTML = 'â³ æµ‹è¯•æ‰¹é‡åˆå¹¶...'
      await new Promise(r => setTimeout(r, 10))
      
      // åˆ›å»ºä¸é‡å çš„ 2x2 åˆå¹¶åŒºåŸŸ
      const mergeStart = performance.now()
      let successCount = 0
      for (let i = 0; i < count; i++) {
        const baseRow = Math.floor(i / 50) * 3
        const baseCol = (i % 50) * 3
        if (model.mergeCells(baseRow, baseCol, baseRow + 1, baseCol + 1)) {
          successCount++
        }
      }
      const mergeTime = performance.now() - mergeStart
      
      const mergeRate = Math.round(count / (mergeTime / 1000))
      document.getElementById('metricMergeRate').textContent = mergeRate.toLocaleString()
      document.getElementById('metricRegionCount').textContent = model.getAllMergedRegions().length.toLocaleString()
      
      resultDiv.innerHTML = `
âœ… æ‰¹é‡åˆå¹¶æµ‹è¯•å®Œæˆ (ä½¿ç”¨çœŸå® SheetModel)

ğŸ“Š æµ‹è¯•è§„æ¨¡: ${count.toLocaleString()} ä¸ª 2Ã—2 åˆå¹¶åŒºåŸŸ

â±ï¸ åˆå¹¶æ€§èƒ½:
  â€¢ æ€»æ—¶é—´: <span class="badge ${getSpeedClass(mergeTime, {fast: 100, medium: 500})}">${formatTime(mergeTime)}</span>
  â€¢ å¹³å‡æ—¶é—´: ${formatTime(mergeTime / count)}/æ¬¡
  â€¢ åˆå¹¶é€Ÿç‡: <span class="badge fast">${mergeRate.toLocaleString()} åŒºåŸŸ/ç§’</span>

ğŸ“Š ç»“æœéªŒè¯:
  â€¢ æˆåŠŸåˆå¹¶: ${successCount.toLocaleString()} ä¸ª
  â€¢ å½“å‰åˆå¹¶åŒºåŸŸæ•°: ${model.getAllMergedRegions().length.toLocaleString()}

ğŸ“ˆ æ€§èƒ½è¯„ä¼°:
  ${mergeTime / count < 0.1 ? 'ğŸš€ ä¼˜ç§€ - åˆå¹¶æ“ä½œæå¿«' : 
    mergeTime / count < 0.5 ? 'âœ… è‰¯å¥½ - åˆå¹¶æ“ä½œæ­£å¸¸' : 
    'âš ï¸ éœ€ä¼˜åŒ– - åˆå¹¶æ“ä½œè¾ƒæ…¢'}
`
      window._testModel = model
    }
    
    // æµ‹è¯• 2: æ‰¹é‡å–æ¶ˆåˆå¹¶
    window.testUnmerge = async function(count) {
      const resultDiv = document.getElementById('result2')
      resultDiv.innerHTML = 'â³ å‡†å¤‡åˆå¹¶åŒºåŸŸ...'
      
      await new Promise(r => setTimeout(r, 10))
      
      const model = new SheetModel()
      
      // å…ˆåˆ›å»ºåˆå¹¶åŒºåŸŸ
      for (let i = 0; i < count; i++) {
        const baseRow = Math.floor(i / 50) * 3
        const baseCol = (i % 50) * 3
        model.mergeCells(baseRow, baseCol, baseRow + 1, baseCol + 1)
      }
      
      const regionsBefore = model.getAllMergedRegions().length
      
      resultDiv.innerHTML = 'â³ æµ‹è¯•æ‰¹é‡å–æ¶ˆåˆå¹¶...'
      await new Promise(r => setTimeout(r, 10))
      
      const unmergeStart = performance.now()
      for (let i = 0; i < count; i++) {
        const baseRow = Math.floor(i / 50) * 3
        const baseCol = (i % 50) * 3
        model.unmergeCells(baseRow, baseCol)
      }
      const unmergeTime = performance.now() - unmergeStart
      
      const unmergeRate = Math.round(count / (unmergeTime / 1000))
      document.getElementById('metricUnmergeRate').textContent = unmergeRate.toLocaleString()
      
      const regionsAfter = model.getAllMergedRegions().length
      
      resultDiv.innerHTML = `
âœ… æ‰¹é‡å–æ¶ˆåˆå¹¶æµ‹è¯•å®Œæˆ (ä½¿ç”¨çœŸå® SheetModel)

ğŸ“Š æµ‹è¯•è§„æ¨¡: ${count.toLocaleString()} ä¸ªåˆå¹¶åŒºåŸŸ

â±ï¸ å–æ¶ˆåˆå¹¶æ€§èƒ½:
  â€¢ æ€»æ—¶é—´: <span class="badge ${getSpeedClass(unmergeTime, {fast: 100, medium: 500})}">${formatTime(unmergeTime)}</span>
  â€¢ å¹³å‡æ—¶é—´: ${formatTime(unmergeTime / count)}/æ¬¡
  â€¢ å–æ¶ˆé€Ÿç‡: <span class="badge fast">${unmergeRate.toLocaleString()} åŒºåŸŸ/ç§’</span>

ğŸ“Š ç»“æœéªŒè¯:
  â€¢ å–æ¶ˆå‰åŒºåŸŸæ•°: ${regionsBefore.toLocaleString()}
  â€¢ å–æ¶ˆååŒºåŸŸæ•°: ${regionsAfter.toLocaleString()}

ğŸ“ˆ æ€§èƒ½è¯„ä¼°:
  ${unmergeTime / count < 0.1 ? 'ğŸš€ ä¼˜ç§€ - å–æ¶ˆåˆå¹¶æå¿«' : 
    unmergeTime / count < 0.5 ? 'âœ… è‰¯å¥½ - å–æ¶ˆåˆå¹¶æ­£å¸¸' : 
    'âš ï¸ éœ€ä¼˜åŒ– - å–æ¶ˆåˆå¹¶è¾ƒæ…¢'}
`
    }
    
    // æµ‹è¯• 3: çŠ¶æ€æŸ¥è¯¢
    window.testMergeQuery = async function(count) {
      const resultDiv = document.getElementById('result3')
      resultDiv.innerHTML = 'â³ å‡†å¤‡åˆå¹¶åŒºåŸŸ...'
      
      await new Promise(r => setTimeout(r, 10))
      
      const model = new SheetModel()
      
      // åˆ›å»º 500 ä¸ªåˆå¹¶åŒºåŸŸ
      for (let i = 0; i < 500; i++) {
        const baseRow = Math.floor(i / 25) * 4
        const baseCol = (i % 25) * 4
        model.mergeCells(baseRow, baseCol, baseRow + 1, baseCol + 1)
      }
      
      resultDiv.innerHTML = 'â³ æµ‹è¯•çŠ¶æ€æŸ¥è¯¢...'
      await new Promise(r => setTimeout(r, 10))
      
      const queryStart = performance.now()
      for (let i = 0; i < count; i++) {
        const row = Math.floor(Math.random() * 200)
        const col = Math.floor(Math.random() * 100)
        model.getMergedRegion(row, col)
        model.isMergedCell(row, col)
        model.getMergedCellInfo(row, col)
      }
      const queryTime = performance.now() - queryStart
      
      const queryRate = Math.round(count / (queryTime / 1000))
      document.getElementById('metricQueryRate').textContent = queryRate.toLocaleString()
      
      resultDiv.innerHTML = `
âœ… åˆå¹¶çŠ¶æ€æŸ¥è¯¢æµ‹è¯•å®Œæˆ (ä½¿ç”¨çœŸå® SheetModel)

ğŸ“Š æµ‹è¯•è§„æ¨¡: ${count.toLocaleString()} æ¬¡æŸ¥è¯¢ (æ¯æ¬¡è°ƒç”¨ 3 ä¸ªæ–¹æ³•)
ğŸ“Š åˆå¹¶åŒºåŸŸæ•°: 500 ä¸ª

â±ï¸ æŸ¥è¯¢æ€§èƒ½:
  â€¢ æ€»æ—¶é—´: <span class="badge ${getSpeedClass(queryTime, {fast: 100, medium: 500})}">${formatTime(queryTime)}</span>
  â€¢ å¹³å‡æ—¶é—´: ${formatTime(queryTime / count)}/æ¬¡
  â€¢ æŸ¥è¯¢é€Ÿç‡: <span class="badge fast">${queryRate.toLocaleString()} æ¬¡/ç§’</span>

ğŸ“Š æŸ¥è¯¢æ–¹æ³•:
  â€¢ getMergedRegion - è·å–åˆå¹¶åŒºåŸŸ
  â€¢ isMergedCell - åˆ¤æ–­æ˜¯å¦åˆå¹¶
  â€¢ getMergedCellInfo - è·å–è¯¦ç»†ä¿¡æ¯

ğŸ“ˆ æ€§èƒ½è¯„ä¼°:
  ${queryTime / count < 0.01 ? 'ğŸš€ ä¼˜ç§€ - æŸ¥è¯¢æ€§èƒ½æå¿«' : 
    queryTime / count < 0.05 ? 'âœ… è‰¯å¥½ - æŸ¥è¯¢æ€§èƒ½æ­£å¸¸' : 
    'âš ï¸ éœ€ä¼˜åŒ– - æŸ¥è¯¢æ€§èƒ½è¾ƒæ…¢'}
`
    }
    
    // æµ‹è¯• 4: å¤§åŒºåŸŸåˆå¹¶
    window.testLargeMerge = async function(rows, cols) {
      const resultDiv = document.getElementById('result4')
      resultDiv.innerHTML = 'â³ åˆ›å»º SheetModel å®ä¾‹...'
      
      await new Promise(r => setTimeout(r, 10))
      
      const model = new SheetModel()
      const cellCount = rows * cols
      
      // å¡«å……æ•°æ®
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          model.setValue(r, c, `R${r}C${c}`)
        }
      }
      
      resultDiv.innerHTML = 'â³ æµ‹è¯•å¤§åŒºåŸŸåˆå¹¶...'
      await new Promise(r => setTimeout(r, 10))
      
      const mergeStart = performance.now()
      const success = model.mergeCells(0, 0, rows - 1, cols - 1)
      const mergeTime = performance.now() - mergeStart
      
      resultDiv.innerHTML = 'â³ æµ‹è¯•å–æ¶ˆåˆå¹¶...'
      await new Promise(r => setTimeout(r, 10))
      
      const unmergeStart = performance.now()
      model.unmergeCells(0, 0)
      const unmergeTime = performance.now() - unmergeStart
      
      resultDiv.innerHTML = `
âœ… å¤§åŒºåŸŸåˆå¹¶æµ‹è¯•å®Œæˆ (ä½¿ç”¨çœŸå® SheetModel)

ğŸ“Š åŒºåŸŸå¤§å°: ${rows} Ã— ${cols} = ${cellCount.toLocaleString()} å•å…ƒæ ¼

â±ï¸ åˆå¹¶æ€§èƒ½:
  â€¢ åˆå¹¶æ—¶é—´: <span class="badge ${getSpeedClass(mergeTime, {fast: 10, medium: 50})}">${formatTime(mergeTime)}</span>
  â€¢ åˆå¹¶ç»“æœ: ${success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}

â±ï¸ å–æ¶ˆåˆå¹¶æ€§èƒ½:
  â€¢ å–æ¶ˆæ—¶é—´: <span class="badge ${getSpeedClass(unmergeTime, {fast: 10, medium: 50})}">${formatTime(unmergeTime)}</span>

ğŸ“ˆ æ€§èƒ½è¯„ä¼°:
  ${mergeTime < 20 ? 'ğŸš€ ä¼˜ç§€ - å¤§åŒºåŸŸåˆå¹¶æå¿«' : 
    mergeTime < 100 ? 'âœ… è‰¯å¥½ - å¤§åŒºåŸŸåˆå¹¶æ­£å¸¸' : 
    'âš ï¸ éœ€ä¼˜åŒ– - å¤§åŒºåŸŸåˆå¹¶è¾ƒæ…¢'}
`
    }
    
    // æµ‹è¯• 5: è¾¹æ¡†å¤„ç†
    window.testMergeBorder = async function(count) {
      const resultDiv = document.getElementById('result5')
      resultDiv.innerHTML = 'â³ è®¾ç½®è¾¹æ¡†...'
      
      await new Promise(r => setTimeout(r, 10))
      
      const model = new SheetModel()
      
      // ä¸ºæ¯ä¸ªè¦åˆå¹¶çš„åŒºåŸŸè®¾ç½®è¾¹æ¡†
      for (let i = 0; i < count; i++) {
        const baseRow = Math.floor(i / 25) * 4
        const baseCol = (i % 25) * 4
        
        // è®¾ç½®å¤–è¾¹æ¡†
        for (let c = baseCol; c <= baseCol + 1; c++) {
          model.setCellBorder(baseRow, c, { top: { style: 'thin', color: '#000' } })
          model.setCellBorder(baseRow + 1, c, { bottom: { style: 'thin', color: '#000' } })
        }
        for (let r = baseRow; r <= baseRow + 1; r++) {
          model.setCellBorder(r, baseCol, { left: { style: 'thin', color: '#000' } })
          model.setCellBorder(r, baseCol + 1, { right: { style: 'thin', color: '#000' } })
        }
      }
      
      resultDiv.innerHTML = 'â³ æµ‹è¯•å¸¦è¾¹æ¡†çš„åˆå¹¶...'
      await new Promise(r => setTimeout(r, 10))
      
      const mergeStart = performance.now()
      for (let i = 0; i < count; i++) {
        const baseRow = Math.floor(i / 25) * 4
        const baseCol = (i % 25) * 4
        model.mergeCells(baseRow, baseCol, baseRow + 1, baseCol + 1)
      }
      const mergeTime = performance.now() - mergeStart
      
      resultDiv.innerHTML = 'â³ æµ‹è¯•å–æ¶ˆåˆå¹¶ (è¾¹æ¡†åˆ†å‘)...'
      await new Promise(r => setTimeout(r, 10))
      
      const unmergeStart = performance.now()
      for (let i = 0; i < count; i++) {
        const baseRow = Math.floor(i / 25) * 4
        const baseCol = (i % 25) * 4
        model.unmergeCells(baseRow, baseCol)
      }
      const unmergeTime = performance.now() - unmergeStart
      
      resultDiv.innerHTML = `
âœ… è¾¹æ¡†å¤„ç†æµ‹è¯•å®Œæˆ (ä½¿ç”¨çœŸå® SheetModel)

ğŸ“Š æµ‹è¯•è§„æ¨¡: ${count.toLocaleString()} ä¸ªå¸¦è¾¹æ¡†çš„ 2Ã—2 åˆå¹¶åŒºåŸŸ

â±ï¸ åˆå¹¶æ€§èƒ½ (è¾¹æ¡†æ”¶é›†):
  â€¢ åˆå¹¶æ—¶é—´: <span class="badge ${getSpeedClass(mergeTime, {fast: 200, medium: 800})}">${formatTime(mergeTime)}</span>
  â€¢ å¹³å‡æ¯åŒºåŸŸ: ${formatTime(mergeTime / count)}

â±ï¸ å–æ¶ˆåˆå¹¶æ€§èƒ½ (è¾¹æ¡†åˆ†å‘):
  â€¢ å–æ¶ˆæ—¶é—´: <span class="badge ${getSpeedClass(unmergeTime, {fast: 200, medium: 800})}">${formatTime(unmergeTime)}</span>
  â€¢ å¹³å‡æ¯åŒºåŸŸ: ${formatTime(unmergeTime / count)}

ğŸ“Š Excel è¡Œä¸ºè¯´æ˜:
  â€¢ åˆå¹¶æ—¶: æ”¶é›†å¤–è¾¹æ¡†åˆ°ä¸»å•å…ƒæ ¼
  â€¢ å–æ¶ˆæ—¶: åˆ†å‘è¾¹æ¡†åˆ°å„è¾¹ç•Œå•å…ƒæ ¼

ğŸ“ˆ æ€§èƒ½è¯„ä¼°:
  ${(mergeTime + unmergeTime) / count < 0.5 ? 'ğŸš€ ä¼˜ç§€ - è¾¹æ¡†å¤„ç†æå¿«' : 
    (mergeTime + unmergeTime) / count < 2 ? 'âœ… è‰¯å¥½ - è¾¹æ¡†å¤„ç†æ­£å¸¸' : 
    'âš ï¸ éœ€ä¼˜åŒ– - è¾¹æ¡†å¤„ç†è¾ƒæ…¢'}
`
    }
    
    // æµ‹è¯• 6: canMerge æ£€æŸ¥
    window.testCanMerge = async function(count) {
      const resultDiv = document.getElementById('result6')
      resultDiv.innerHTML = 'â³ å‡†å¤‡åˆå¹¶åŒºåŸŸ...'
      
      await new Promise(r => setTimeout(r, 10))
      
      const model = new SheetModel()
      
      // åˆ›å»º 200 ä¸ªåˆå¹¶åŒºåŸŸ
      for (let i = 0; i < 200; i++) {
        const baseRow = Math.floor(i / 20) * 5
        const baseCol = (i % 20) * 5
        model.mergeCells(baseRow, baseCol, baseRow + 1, baseCol + 1)
      }
      
      resultDiv.innerHTML = 'â³ æµ‹è¯• canMerge æ£€æŸ¥...'
      await new Promise(r => setTimeout(r, 10))
      
      let canMergeCount = 0
      let cannotMergeCount = 0
      
      const checkStart = performance.now()
      for (let i = 0; i < count; i++) {
        const row = Math.floor(Math.random() * 100)
        const col = Math.floor(Math.random() * 100)
        const result = model.canMerge(row, col, row + 2, col + 2)
        if (result) canMergeCount++
        else cannotMergeCount++
      }
      const checkTime = performance.now() - checkStart
      
      const checkRate = Math.round(count / (checkTime / 1000))
      
      resultDiv.innerHTML = `
âœ… canMerge æ£€æŸ¥æµ‹è¯•å®Œæˆ (ä½¿ç”¨çœŸå® SheetModel)

ğŸ“Š æµ‹è¯•è§„æ¨¡: ${count.toLocaleString()} æ¬¡ canMerge æ£€æŸ¥
ğŸ“Š ç°æœ‰åˆå¹¶åŒºåŸŸ: 200 ä¸ª

â±ï¸ æ£€æŸ¥æ€§èƒ½:
  â€¢ æ€»æ—¶é—´: <span class="badge ${getSpeedClass(checkTime, {fast: 100, medium: 500})}">${formatTime(checkTime)}</span>
  â€¢ å¹³å‡æ—¶é—´: ${formatTime(checkTime / count)}/æ¬¡
  â€¢ æ£€æŸ¥é€Ÿç‡: <span class="badge fast">${checkRate.toLocaleString()} æ¬¡/ç§’</span>

ğŸ“Š æ£€æŸ¥ç»“æœ:
  â€¢ å¯ä»¥åˆå¹¶: ${canMergeCount.toLocaleString()} æ¬¡
  â€¢ å­˜åœ¨å†²çª: ${cannotMergeCount.toLocaleString()} æ¬¡
  â€¢ å†²çªç‡: ${(cannotMergeCount / count * 100).toFixed(1)}%

ğŸ“ˆ æ€§èƒ½è¯„ä¼°:
  ${checkTime / count < 0.01 ? 'ğŸš€ ä¼˜ç§€ - å†²çªæ£€æŸ¥æå¿«' : 
    checkTime / count < 0.05 ? 'âœ… è‰¯å¥½ - å†²çªæ£€æŸ¥æ­£å¸¸' : 
    'âš ï¸ éœ€ä¼˜åŒ– - å†²çªæ£€æŸ¥è¾ƒæ…¢'}
`
    }
    
    // æµ‹è¯• 7: åˆå¹¶/å–æ¶ˆåˆå¹¶å¾ªç¯
    window.testMergeUnmergeCycle = async function(regionCount, cycles) {
      const resultDiv = document.getElementById('result7')
      resultDiv.innerHTML = 'â³ å¼€å§‹å¾ªç¯æµ‹è¯•...'
      
      await new Promise(r => setTimeout(r, 10))
      
      const model = new SheetModel()
      const times = { merge: [], unmerge: [] }
      
      for (let cycle = 0; cycle < cycles; cycle++) {
        resultDiv.innerHTML = `â³ ç¬¬ ${cycle + 1}/${cycles} è½®æµ‹è¯•ä¸­...`
        
        // åˆå¹¶
        const mergeStart = performance.now()
        for (let i = 0; i < regionCount; i++) {
          const baseRow = Math.floor(i / 25) * 3
          const baseCol = (i % 25) * 3
          model.mergeCells(baseRow, baseCol, baseRow + 1, baseCol + 1)
        }
        times.merge.push(performance.now() - mergeStart)
        
        await new Promise(r => setTimeout(r, 5))
        
        // å–æ¶ˆåˆå¹¶
        const unmergeStart = performance.now()
        for (let i = 0; i < regionCount; i++) {
          const baseRow = Math.floor(i / 25) * 3
          const baseCol = (i % 25) * 3
          model.unmergeCells(baseRow, baseCol)
        }
        times.unmerge.push(performance.now() - unmergeStart)
        
        await new Promise(r => setTimeout(r, 5))
      }
      
      const avgMerge = times.merge.reduce((a, b) => a + b, 0) / cycles
      const avgUnmerge = times.unmerge.reduce((a, b) => a + b, 0) / cycles
      const minMerge = Math.min(...times.merge)
      const maxMerge = Math.max(...times.merge)
      const minUnmerge = Math.min(...times.unmerge)
      const maxUnmerge = Math.max(...times.unmerge)
      
      resultDiv.innerHTML = `
âœ… åˆå¹¶/å–æ¶ˆåˆå¹¶å¾ªç¯æµ‹è¯•å®Œæˆ (ä½¿ç”¨çœŸå® SheetModel)

ğŸ“Š æµ‹è¯•è§„æ¨¡: ${regionCount} ä¸ªåŒºåŸŸ Ã— ${cycles} è½®å¾ªç¯

â±ï¸ åˆå¹¶æ€§èƒ½ç»Ÿè®¡:
  â€¢ å¹³å‡æ—¶é—´: <span class="badge fast">${formatTime(avgMerge)}</span>
  â€¢ æœ€å¿«: ${formatTime(minMerge)}
  â€¢ æœ€æ…¢: ${formatTime(maxMerge)}
  â€¢ æ³¢åŠ¨: ${((maxMerge - minMerge) / avgMerge * 100).toFixed(1)}%

â±ï¸ å–æ¶ˆåˆå¹¶æ€§èƒ½ç»Ÿè®¡:
  â€¢ å¹³å‡æ—¶é—´: <span class="badge fast">${formatTime(avgUnmerge)}</span>
  â€¢ æœ€å¿«: ${formatTime(minUnmerge)}
  â€¢ æœ€æ…¢: ${formatTime(maxUnmerge)}
  â€¢ æ³¢åŠ¨: ${((maxUnmerge - minUnmerge) / avgUnmerge * 100).toFixed(1)}%

ğŸ“ˆ ç¨³å®šæ€§è¯„ä¼°:
  ${Math.max((maxMerge - minMerge) / avgMerge, (maxUnmerge - minUnmerge) / avgUnmerge) < 0.3 
    ? 'ğŸš€ ä¼˜ç§€ - æ€§èƒ½éå¸¸ç¨³å®š' 
    : Math.max((maxMerge - minMerge) / avgMerge, (maxUnmerge - minUnmerge) / avgUnmerge) < 0.5 
    ? 'âœ… è‰¯å¥½ - æ€§èƒ½è¾ƒä¸ºç¨³å®š' 
    : 'âš ï¸ éœ€å…³æ³¨ - æ€§èƒ½æ³¢åŠ¨è¾ƒå¤§'}
`
    }
  </script>
</body>
</html>
