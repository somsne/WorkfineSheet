<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¼‚æ­¥è®¡ç®—æ€§èƒ½æµ‹è¯• - WorkfineSheet</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 32px;
    }

    .description {
      color: #666;
      margin-bottom: 10px;
      line-height: 1.6;
    }

    .system-info {
      display: flex;
      gap: 20px;
      margin-top: 15px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      font-size: 13px;
    }

    .system-info-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .system-info-label {
      color: #666;
      font-weight: 500;
    }

    .system-info-value {
      color: #333;
      font-family: 'Courier New', monospace;
      background: white;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .test-section {
      background: white;
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .test-section h2 {
      color: #333;
      margin-bottom: 15px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .test-section p {
      color: #666;
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    button:active {
      transform: translateY(0);
    }

    .btn-primary {
      background: #4CAF50;
      color: white;
    }

    .btn-primary:hover {
      background: #45a049;
    }

    .btn-secondary {
      background: #2196F3;
      color: white;
    }

    .btn-secondary:hover {
      background: #0b7dda;
    }

    .btn-warning {
      background: #FF9800;
      color: white;
    }

    .btn-warning:hover {
      background: #e68900;
    }

    .btn-danger {
      background: #f44336;
      color: white;
    }

    .btn-danger:hover {
      background: #da190b;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    button:disabled:hover {
      transform: none;
      box-shadow: none;
    }

    .result-box {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #4CAF50;
      white-space: pre-line;
      line-height: 1.8;
      font-size: 14px;
      color: #333;
      min-height: 100px;
      margin-top: 15px;
      max-height: 500px;
      overflow-y: auto;
    }

    .result-box::-webkit-scrollbar {
      width: 8px;
    }

    .result-box::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    .result-box::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }

    .result-box::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    .metric {
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 4px;
      background: #e8f5e9;
    }

    .metric.fast {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .metric.medium {
      background: #fff3e0;
      color: #f57c00;
    }

    .metric.slow {
      background: #ffebee;
      color: #c62828;
    }

    .ui-test-area {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      border: 2px dashed #ddd;
      margin-top: 20px;
    }

    .ui-test-area h3 {
      color: #333;
      margin-bottom: 15px;
      font-size: 16px;
    }

    .animation-box {
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      margin: 20px 0;
      animation: float 3s ease-in-out infinite;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 24px;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }

    .counter {
      font-size: 48px;
      font-weight: bold;
      color: #4CAF50;
      font-family: 'Courier New', monospace;
    }

    .fps-meter {
      display: inline-block;
      padding: 8px 16px;
      background: #333;
      color: #0f0;
      font-family: 'Courier New', monospace;
      border-radius: 6px;
      font-weight: bold;
    }

    .progress-bar {
      width: 100%;
      height: 30px;
      background: #e0e0e0;
      border-radius: 15px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4CAF50, #8BC34A);
      transition: width 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 12px;
    }

    .highlight {
      background: #ffeb3b;
      padding: 2px 4px;
      border-radius: 3px;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      background: #2196F3;
      color: white;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .badge.new {
      background: #f44336;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .stat-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #2196F3;
    }

    .stat-label {
      color: #666;
      font-size: 12px;
      margin-bottom: 5px;
    }

    .stat-value {
      color: #333;
      font-size: 24px;
      font-weight: bold;
      font-family: 'Courier New', monospace;
    }

    .test-running {
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }

    .comparison-table {
      width: 100%;
      margin-top: 15px;
      border-collapse: collapse;
    }

    .comparison-table th,
    .comparison-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    .comparison-table th {
      background: #f5f5f5;
      font-weight: 600;
      color: #333;
    }

    .comparison-table tr:hover {
      background: #f9f9f9;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>âš¡ å¼‚æ­¥è®¡ç®—é˜Ÿåˆ—æ€§èƒ½æµ‹è¯•</h1>
      <p class="description">
        æµ‹è¯• WorkfineSheet å¼‚æ­¥å…¬å¼è®¡ç®—é˜Ÿåˆ—çš„æ€§èƒ½ï¼ŒéªŒè¯åœ¨å¤§é‡è®¡ç®—ä»»åŠ¡æ‰§è¡Œæ—¶ UI æ˜¯å¦ä¿æŒæµç•…ã€‚
        <span class="highlight">å…³é”®æŒ‡æ ‡</span>ï¼šFPS åº”ä¿æŒåœ¨ 55 ä»¥ä¸Šï¼ŒåŠ¨ç”»æµç•…ï¼Œè®¡æ•°å™¨æŒç»­é€’å¢ã€‚
      </p>
      <div class="system-info">
        <div class="system-info-item">
          <span class="system-info-label">æµè§ˆå™¨:</span>
          <span class="system-info-value" id="browserInfo">æ£€æµ‹ä¸­...</span>
        </div>
        <div class="system-info-item">
          <span class="system-info-label">CPU æ ¸å¿ƒ:</span>
          <span class="system-info-value" id="cpuInfo">æ£€æµ‹ä¸­...</span>
        </div>
        <div class="system-info-item">
          <span class="system-info-label">å†…å­˜:</span>
          <span class="system-info-value" id="memoryInfo">æ£€æµ‹ä¸­...</span>
        </div>
      </div>
    </div>

    <!-- UI å“åº”æ€§æµ‹è¯•åŒºåŸŸ -->
    <div class="test-section">
      <h2>
        ğŸ¯ UI å“åº”æ€§ç›‘æ§
        <span class="badge new">å®æ—¶</span>
      </h2>
      <p>åœ¨è®¡ç®—ä»»åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œè¿™äº›UIå…ƒç´ åº”è¯¥ä¿æŒæµç•…ã€‚å¦‚æœå‡ºç°å¡é¡¿ï¼Œè¯´æ˜è®¡ç®—é˜»å¡äº†ä¸»çº¿ç¨‹ã€‚</p>
      
      <div class="ui-test-area">
        <h3>FPS è®¡æ•°å™¨ï¼š<span class="fps-meter" id="fpsDisplay">60 FPS</span></h3>
        <h3>å®æ—¶è®¡æ•°å™¨ï¼š<span class="counter" id="counter">0</span></h3>
        <div class="animation-box" id="animBox">ğŸš€</div>
        <input type="range" id="slider" min="0" max="100" value="50" style="width: 100%; margin: 10px 0;">
        <p style="color: #666;">å°è¯•æ‹–åŠ¨æ»‘å—ï¼Œåº”è¯¥éå¸¸æµç•…æ²¡æœ‰å»¶è¿Ÿ</p>
      </div>
    </div>

    <!-- æµ‹è¯• 1: åˆ›å»ºå¤§é‡å…¬å¼ -->
    <div class="test-section">
      <h2>æµ‹è¯• 1: åˆ›å»ºå¤§é‡å…¬å¼ï¼ˆå¼‚æ­¥ vs åŒæ­¥ï¼‰</h2>
      <p>å¯¹æ¯”åŒæ­¥å’Œå¼‚æ­¥æ¨¡å¼ä¸‹åˆ›å»ºå¤§é‡å…¬å¼çš„æ€§èƒ½è¡¨ç°ã€‚å¼‚æ­¥æ¨¡å¼åº”è¯¥ä¿æŒ UI æµç•…ã€‚</p>
      <div class="button-group">
        <button class="btn-primary" onclick="test1Async(1000)" id="btn1a-1k">å¼‚æ­¥: 1K å…¬å¼</button>
        <button class="btn-primary" onclick="test1Async(10000)" id="btn1a-10k">å¼‚æ­¥: 10K å…¬å¼</button>
        <button class="btn-primary" onclick="test1Async(50000)" id="btn1a-50k">å¼‚æ­¥: 50K å…¬å¼</button>
        <button class="btn-warning" onclick="test1Async(100000)" id="btn1a-100k">å¼‚æ­¥: 100K å…¬å¼ âš¡</button>
        <button class="btn-secondary" onclick="test1Sync(1000)" id="btn1s-1k">åŒæ­¥: 1K å…¬å¼</button>
        <button class="btn-secondary" onclick="test1Sync(5000)" id="btn1s-5k">åŒæ­¥: 5K å…¬å¼</button>
        <button class="btn-danger" onclick="test1Sync(10000)" id="btn1s-10k">åŒæ­¥: 10K âš ï¸</button>
      </div>
      <div id="result1" class="result-box">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>

    <!-- æµ‹è¯• 2: æ’å…¥è¡Œåˆ— -->
    <div class="test-section">
      <h2>æµ‹è¯• 2: æ’å…¥è¡Œåˆ—ï¼ˆå¼‚æ­¥å¤„ç†ï¼‰</h2>
      <p>æµ‹è¯•åœ¨æœ‰å¤§é‡å…¬å¼çš„æƒ…å†µä¸‹æ’å…¥è¡Œåˆ—çš„æ€§èƒ½ã€‚</p>
      <div class="button-group">
        <button class="btn-primary" onclick="test2(1000, 10)">1K å…¬å¼ / æ’å…¥ 10 è¡Œ</button>
        <button class="btn-primary" onclick="test2(10000, 50)">10K å…¬å¼ / æ’å…¥ 50 è¡Œ</button>
        <button class="btn-warning" onclick="test2(50000, 100)">50K å…¬å¼ / æ’å…¥ 100 è¡Œ âš¡</button>
      </div>
      <div id="result2" class="result-box">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
      <div class="progress-bar" style="margin-top: 15px;">
        <div id="progress2" class="progress-fill" style="width: 0%">0%</div>
      </div>
    </div>

    <!-- æµ‹è¯• 3: åµŒå¥—å…¬å¼æµ‹è¯• -->
    <div class="test-section">
      <h2>æµ‹è¯• 3: åµŒå¥—å…¬å¼è®¡ç®—</h2>
      <p>æµ‹è¯•æ·±åº¦åµŒå¥—çš„å…¬å¼è®¡ç®—æ€§èƒ½ï¼ŒéªŒè¯é€’å½’ä¾èµ–å…³ç³»å¤„ç†æ˜¯å¦æ­£ç¡®ã€‚</p>
      <div class="button-group">
        <button class="btn-primary" onclick="test3Nested(10)">10 å±‚åµŒå¥—</button>
        <button class="btn-primary" onclick="test3Nested(50)">50 å±‚åµŒå¥—</button>
        <button class="btn-warning" onclick="test3Nested(100)">100 å±‚åµŒå¥— âš¡</button>
      </div>
      <div id="result3" class="result-box">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>

    <!-- æµ‹è¯• 4: æ··åˆæ“ä½œå‹åŠ›æµ‹è¯• -->
    <div class="test-section">
      <h2>æµ‹è¯• 4: æ··åˆæ“ä½œå‹åŠ›æµ‹è¯•</h2>
      <p>åœ¨è®¡ç®—é˜Ÿåˆ—ç¹å¿™æ—¶è¿›è¡Œå„ç§æ“ä½œï¼ŒæŒç»­æµ‹è¯• UI å“åº”æ€§ã€‚</p>
      <div class="button-group">
        <button class="btn-primary" onclick="test4()" id="btn4-start">å¯åŠ¨æ··åˆå‹åŠ›æµ‹è¯•</button>
        <button class="btn-danger" onclick="stopTest4()" id="btn4-stop" disabled>åœæ­¢æµ‹è¯•</button>
      </div>
      <div id="result4" class="result-box">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>

    <!-- æµ‹è¯• 5: æ€§èƒ½å¯¹æ¯”æ€»ç»“ -->
    <div class="test-section">
      <h2>æµ‹è¯• 5: å…¨é¢æ€§èƒ½å¯¹æ¯”</h2>
      <p>è¿è¡Œä¸€ç³»åˆ—æ ‡å‡†æµ‹è¯•ï¼Œç”Ÿæˆå®Œæ•´çš„æ€§èƒ½å¯¹æ¯”æŠ¥å‘Šã€‚</p>
      <div class="button-group">
        <button class="btn-primary" onclick="test5()" id="btn5-run">è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶</button>
      </div>
      <div id="result5" class="result-box">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>
  </div>

  <script type="module">
    import { SheetModel } from '../src/lib/SheetModel.ts'
    import { FormulaSheet } from '../src/lib/FormulaSheet.ts'

    // ç³»ç»Ÿä¿¡æ¯æ£€æµ‹
    function detectSystemInfo() {
      // æµè§ˆå™¨ä¿¡æ¯
      const ua = navigator.userAgent
      let browserName = 'Unknown'
      if (ua.includes('Chrome')) browserName = 'Chrome'
      else if (ua.includes('Safari')) browserName = 'Safari'
      else if (ua.includes('Firefox')) browserName = 'Firefox'
      else if (ua.includes('Edge')) browserName = 'Edge'
      document.getElementById('browserInfo').textContent = browserName

      // CPU æ ¸å¿ƒæ•°
      document.getElementById('cpuInfo').textContent = navigator.hardwareConcurrency || 'Unknown'

      // å†…å­˜ä¿¡æ¯ï¼ˆä»…éƒ¨åˆ†æµè§ˆå™¨æ”¯æŒï¼‰
      if (navigator.deviceMemory) {
        document.getElementById('memoryInfo').textContent = navigator.deviceMemory + ' GB'
      } else {
        document.getElementById('memoryInfo').textContent = 'Unknown'
      }
    }
    detectSystemInfo()

    // FPS ç›‘æ§
    let lastFrameTime = performance.now()
    let frameCount = 0
    let fps = 60
    let minFPSGlobal = 60
    let maxFPSGlobal = 60

    function updateFPS() {
      frameCount++
      const now = performance.now()
      const delta = now - lastFrameTime

      if (delta >= 1000) {
        fps = Math.round((frameCount * 1000) / delta)
        document.getElementById('fpsDisplay').textContent = fps + ' FPS'
        document.getElementById('fpsDisplay').style.color = fps >= 55 ? '#0f0' : fps >= 30 ? '#ff0' : '#f00'
        
        if (fps < minFPSGlobal) minFPSGlobal = fps
        if (fps > maxFPSGlobal) maxFPSGlobal = fps
        
        frameCount = 0
        lastFrameTime = now
      }

      requestAnimationFrame(updateFPS)
    }
    updateFPS()

    // å®æ—¶è®¡æ•°å™¨
    let counter = 0
    setInterval(() => {
      counter++
      document.getElementById('counter').textContent = counter
    }, 100)

    // æ»‘å—äº¤äº’æµ‹è¯•
    document.getElementById('slider').addEventListener('input', (e) => {
      document.getElementById('animBox').style.opacity = e.target.value / 100
    })

    // è¾…åŠ©å‡½æ•°ï¼šç¦ç”¨æ‰€æœ‰æµ‹è¯•æŒ‰é’®
    function disableAllButtons(disabled) {
      document.querySelectorAll('button').forEach(btn => {
        if (!btn.id.includes('stop')) {
          btn.disabled = disabled
        }
      })
    }

    // æµ‹è¯• 1: å¼‚æ­¥åˆ›å»ºå…¬å¼
    window.test1Async = async function(count) {
      disableAllButtons(true)
      const resultDiv = document.getElementById('result1')
      resultDiv.innerHTML = `â³ å¼‚æ­¥åˆ›å»º ${count.toLocaleString()} ä¸ªå…¬å¼...\n<span class="highlight">æ³¨æ„è§‚å¯Ÿï¼šUI åº”è¯¥ä¿æŒæµç•…ï¼</span>`

      await new Promise(resolve => setTimeout(resolve, 100))

      const model = new SheetModel()
      const sheet = new FormulaSheet(model, true) // å¯ç”¨å¼‚æ­¥æ¨¡å¼

      const startTime = performance.now()
      const startFPS = fps
      let minFPS = fps
      let maxFPS = fps

      // ç›‘æ§æœ€ä½/æœ€é«˜ FPS
      const fpsMonitor = setInterval(() => {
        if (fps < minFPS) minFPS = fps
        if (fps > maxFPS) maxFPS = fps
      }, 100)

      // åˆ›å»ºå…¬å¼
      let progressCount = 0
      for (let i = 0; i < count; i++) {
        const row = Math.floor(i / 100)
        const col = i % 100
        sheet.setValue(row, col, `=A${i + 1}+B${i + 1}`)
        
        progressCount++
        // æ¯1000ä¸ªæš‚åœä¸€å¸§å¹¶æ›´æ–°è¿›åº¦
        if (progressCount % 1000 === 0) {
          resultDiv.innerHTML = `â³ åˆ›å»ºè¿›åº¦: ${progressCount.toLocaleString()} / ${count.toLocaleString()} (${(progressCount/count*100).toFixed(1)}%)\nå½“å‰ FPS: ${fps}`
          await new Promise(resolve => requestAnimationFrame(resolve))
        }
      }

      const createTime = performance.now() - startTime

      // ç­‰å¾…æ‰€æœ‰è®¡ç®—å®Œæˆ
      resultDiv.innerHTML = `â³ ç­‰å¾…è®¡ç®—å®Œæˆ...\nå·²åˆ›å»º: ${count.toLocaleString()} ä¸ªå…¬å¼`
      const calcStart = performance.now()
      while (sheet.getQueueStats().pending > 0 || sheet.getQueueStats().processing > 0) {
        const stats = sheet.getQueueStats()
        resultDiv.innerHTML = `â³ è®¡ç®—ä¸­...\nå¾…å¤„ç†: ${stats.pending} | å¤„ç†ä¸­: ${stats.processing} | å·²å®Œæˆ: ${stats.completed}\nå½“å‰ FPS: ${fps}`
        await new Promise(resolve => setTimeout(resolve, 100))
      }
      const calcTime = performance.now() - calcStart
      const totalTime = performance.now() - startTime

      clearInterval(fpsMonitor)

      const result = `
âœ… <strong>å¼‚æ­¥æ¨¡å¼æµ‹è¯•å®Œæˆ</strong>

<strong>æµ‹è¯•è§„æ¨¡ï¼š</strong>
  - å…¬å¼æ•°é‡: ${count.toLocaleString()} ä¸ª
  - å…¬å¼ç±»å‹: ç®€å•è¿ç®— (A+B)

<strong>åˆ›å»ºæ€§èƒ½ï¼š</strong>
  - åˆ›å»ºæ—¶é—´: <span class="metric fast">${createTime.toFixed(2)} ms</span>
  - åˆ›å»ºé€Ÿç‡: ${Math.round(count / (createTime / 1000)).toLocaleString()} å…¬å¼/ç§’

<strong>è®¡ç®—æ€§èƒ½ï¼š</strong>
  - è®¡ç®—æ—¶é—´: <span class="metric ${calcTime < 2000 ? 'fast' : calcTime < 5000 ? 'medium' : 'slow'}">${calcTime.toFixed(2)} ms</span>
  - è®¡ç®—é€Ÿç‡: ${Math.round(count / (calcTime / 1000)).toLocaleString()} å…¬å¼/ç§’
  - æ€»è€—æ—¶: <span class="metric">${totalTime.toFixed(2)} ms</span>

<strong>é˜Ÿåˆ—ç»Ÿè®¡ï¼š</strong>
  - å·²å®Œæˆ: ${sheet.getQueueStats().completed}
  - å¤±è´¥: ${sheet.getQueueStats().failed}

<strong>UI æµç•…åº¦ï¼š</strong>
  - æµ‹è¯•å‰ FPS: ${startFPS}
  - æœ€ä½ FPS: <span class="metric ${minFPS >= 55 ? 'fast' : minFPS >= 30 ? 'medium' : 'slow'}">${minFPS}</span>
  - æœ€é«˜ FPS: <span class="metric fast">${maxFPS}</span>
  - FPS è¯„ä»·: ${minFPS >= 55 ? 'ğŸ‰ UI éå¸¸æµç•…ï¼' : minFPS >= 30 ? 'âœ… UI åŸºæœ¬æµç•…' : 'âš ï¸ UI æœ‰å¡é¡¿'}

<strong>æ€§èƒ½ç»“è®ºï¼š</strong>
  ${minFPS >= 55 ? 'âœ… å¼‚æ­¥è®¡ç®—æˆåŠŸé¿å…äº† UI é˜»å¡ï¼Œç”¨æˆ·ä½“éªŒä¼˜ç§€' : minFPS >= 30 ? 'âœ… å¼‚æ­¥å¤„ç†æœ‰æ•ˆï¼Œä½†å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–æ‰¹å¤„ç†å¤§å°' : 'âš ï¸ éœ€è¦ä¼˜åŒ–ï¼šè€ƒè™‘å‡å°æ‰¹å¤„ç†å¤§å°æˆ–å¢åŠ å¸§é—´éš”'}
`
      resultDiv.innerHTML = result
      disableAllButtons(false)
    }

    // æµ‹è¯• 1: åŒæ­¥åˆ›å»ºå…¬å¼ï¼ˆå¯¹æ¯”ï¼‰
    window.test1Sync = async function(count) {
      if (count > 10000) {
        if (!confirm(`è­¦å‘Šï¼šåŒæ­¥åˆ›å»º ${count.toLocaleString()} ä¸ªå…¬å¼å¯èƒ½å¯¼è‡´æµè§ˆå™¨å¡æ­»ï¼\nå»ºè®®æ•°é‡ä¸è¶…è¿‡ 10000ã€‚\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ`)) {
          return
        }
      }

      disableAllButtons(true)
      const resultDiv = document.getElementById('result1')
      resultDiv.innerHTML = `â³ åŒæ­¥åˆ›å»º ${count.toLocaleString()} ä¸ªå…¬å¼...\n<span class="highlight">è­¦å‘Šï¼šUI å°†ä¼šå†»ç»“ï¼</span>`

      await new Promise(resolve => setTimeout(resolve, 100))

      const model = new SheetModel()
      const sheet = new FormulaSheet(model, false) // ç¦ç”¨å¼‚æ­¥æ¨¡å¼

      const startTime = performance.now()
      const startFPS = fps
      let minFPS = fps

      const fpsMonitor = setInterval(() => {
        if (fps < minFPS) minFPS = fps
      }, 100)

      // åˆ›å»ºå¹¶åŒæ­¥è®¡ç®—å…¬å¼ï¼ˆè¿™ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼‰
      for (let i = 0; i < count; i++) {
        const row = Math.floor(i / 100)
        const col = i % 100
        sheet.setValue(row, col, `=A${i + 1}+B${i + 1}`)
        sheet.getValueSync(row, col) // å¼ºåˆ¶åŒæ­¥è®¡ç®—
      }

      const totalTime = performance.now() - startTime
      clearInterval(fpsMonitor)

      const result = `
âœ… <strong>åŒæ­¥æ¨¡å¼æµ‹è¯•å®Œæˆ</strong>

<strong>æµ‹è¯•è§„æ¨¡ï¼š</strong>
  - å…¬å¼æ•°é‡: ${count.toLocaleString()} ä¸ª
  - å…¬å¼ç±»å‹: ç®€å•è¿ç®— (A+B)

<strong>æ€»ä½“æ€§èƒ½ï¼š</strong>
  - æ€»æ—¶é—´: <span class="metric ${totalTime < 1000 ? 'fast' : totalTime < 5000 ? 'medium' : 'slow'}">${totalTime.toFixed(2)} ms</span>
  - é€Ÿç‡: ${Math.round(count / (totalTime / 1000)).toLocaleString()} å…¬å¼/ç§’

<strong>UI æµç•…åº¦ï¼š</strong>
  - æµ‹è¯•å‰ FPS: ${startFPS}
  - æœ€ä½ FPS: <span class="metric ${minFPS >= 55 ? 'fast' : minFPS >= 30 ? 'medium' : 'slow'}">${minFPS}</span>
  - FPS ä¸‹é™: <span class="metric ${startFPS - minFPS < 10 ? 'fast' : startFPS - minFPS < 30 ? 'medium' : 'slow'}">${startFPS - minFPS}</span>

<strong>é˜»å¡æ—¶é•¿ï¼š</strong>
  - ä¼°ç®—é˜»å¡: <span class="metric slow">~${totalTime.toFixed(0)} ms</span>
  - ç”¨æˆ·ä½“éªŒ: ${minFPS >= 55 ? 'âœ… æ„å¤–è‰¯å¥½ï¼ˆæ•°æ®é‡å°ï¼‰' : minFPS >= 30 ? 'âš ï¸ æ˜æ˜¾å¡é¡¿' : 'âŒ å®Œå…¨å†»ç»“'}

<strong>æ€§èƒ½ç»“è®ºï¼š</strong>
  ${minFPS < 30 ? 'âŒ åŒæ­¥è®¡ç®—ä¸¥é‡é˜»å¡ä¸»çº¿ç¨‹ï¼Œä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ' : minFPS < 55 ? 'âš ï¸ åŒæ­¥æ¨¡å¼ä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼Œå»ºè®®ä½¿ç”¨å¼‚æ­¥' : 'âœ… å°è§„æ¨¡æ•°æ®ä¸‹åŒæ­¥æ¨¡å¼å¯æ¥å—'}
`
      resultDiv.innerHTML = result
      disableAllButtons(false)
    }

    // æµ‹è¯• 2: æ’å…¥è¡Œåˆ—
    window.test2 = async function(formulaCount, insertCount) {
      const resultDiv = document.getElementById('result2')
      const progressBar = document.getElementById('progress2')
      resultDiv.innerHTML = 'â³ åˆå§‹åŒ–æµ‹è¯•...'

      await new Promise(resolve => setTimeout(resolve, 100))

      const model = new SheetModel()
      const sheet = new FormulaSheet(model, true)

      // åˆ›å»ºå…¬å¼
      resultDiv.innerHTML = `â³ åˆ›å»º ${formulaCount.toLocaleString()} ä¸ªå…¬å¼...`
      for (let i = 0; i < formulaCount; i++) {
        const row = Math.floor(i / 100)
        const col = i % 100
        sheet.setValue(row, col, `=A${i + 1}+B${i + 1}`)
        
        if ((i + 1) % 1000 === 0) {
          await new Promise(resolve => requestAnimationFrame(resolve))
          progressBar.style.width = ((i + 1) / formulaCount * 50) + '%'
          progressBar.textContent = Math.round((i + 1) / formulaCount * 50) + '%'
        }
      }

      // ç­‰å¾…è®¡ç®—å®Œæˆ
      while (sheet.getQueueStats().pending > 0 || sheet.getQueueStats().processing > 0) {
        await new Promise(resolve => setTimeout(resolve, 50))
      }

      resultDiv.innerHTML = `â³ æ’å…¥ ${insertCount} è¡Œ...\n<span class="highlight">æ³¨æ„è§‚å¯Ÿ FPSï¼</span>`
      
      const startTime = performance.now()
      const startFPS = fps
      let minFPS = fps

      const fpsMonitor = setInterval(() => {
        if (fps < minFPS) minFPS = fps
      }, 100)

      // æ’å…¥è¡Œ
      for (let i = 0; i < insertCount; i++) {
        await sheet.adjustAllFormulasAsync('insertRow', 0, 1, (current, total) => {
          const progress = 50 + (current / total * 50)
          progressBar.style.width = progress + '%'
          progressBar.textContent = Math.round(progress) + '%'
        })
      }

      const insertTime = performance.now() - startTime
      clearInterval(fpsMonitor)

      progressBar.style.width = '100%'
      progressBar.textContent = '100%'

      const result = `
âœ… <strong>æ’å…¥è¡Œæµ‹è¯•å®Œæˆ</strong>

<strong>æµ‹è¯•è§„æ¨¡ï¼š</strong>
  - å…¬å¼æ•°é‡: ${formulaCount.toLocaleString()} ä¸ª
  - æ’å…¥è¡Œæ•°: ${insertCount}

<strong>æ€§èƒ½è¡¨ç°ï¼š</strong>
  - æ’å…¥æ—¶é—´: <span class="metric ${insertTime < 5000 ? 'fast' : 'medium'}">${insertTime.toFixed(2)} ms</span>
  - å¹³å‡æ—¶é—´: ${(insertTime / insertCount).toFixed(2)} ms/è¡Œ

<strong>UI æµç•…åº¦ï¼š</strong>
  - æœ€ä½ FPS: <span class="metric ${minFPS >= 55 ? 'fast' : minFPS >= 30 ? 'medium' : 'slow'}">${minFPS}</span>
  - ${minFPS >= 55 ? 'ğŸ‰ UI å®Œå…¨æµç•…ï¼' : minFPS >= 30 ? 'âœ… UI åŸºæœ¬æµç•…' : 'âš ï¸ UI æœ‰å¡é¡¿'}

<strong>ç»“è®ºï¼š</strong>
${minFPS >= 30 ? 'âœ… å¼‚æ­¥å¤„ç†æˆåŠŸé¿å…äº† UI é˜»å¡' : 'âš ï¸ éœ€è¦ä¼˜åŒ–æ‰¹å¤„ç†ç­–ç•¥'}
`
      resultDiv.innerHTML = result
    }

    // æµ‹è¯• 3: åµŒå¥—å…¬å¼æµ‹è¯•
    window.test3Nested = async function(depth) {
      disableAllButtons(true)
      const resultDiv = document.getElementById('result3')
      resultDiv.innerHTML = `â³ åˆ›å»º ${depth} å±‚åµŒå¥—å…¬å¼...\n<span class="highlight">éªŒè¯é€’å½’ä¾èµ–è®¡ç®—</span>`

      await new Promise(resolve => setTimeout(resolve, 100))

      const model = new SheetModel()
      const sheet = new FormulaSheet(model, true)

      const startTime = performance.now()
      const startFPS = fps
      let minFPS = fps

      const fpsMonitor = setInterval(() => {
        if (fps < minFPS) minFPS = fps
      }, 100)

      // æ„å»ºåµŒå¥—å…¬å¼é“¾
      // A1 = 1, B1 = 2
      // A2 = A1+1, B2 = A2+B1
      // A3 = A2+1, B3 = A3+B2
      // ...
      sheet.setValue(0, 0, '1')
      sheet.setValue(0, 1, '2')

      for (let i = 1; i <= depth; i++) {
        sheet.setValue(i, 0, `=A${i}+1`)
        sheet.setValue(i, 1, `=A${i + 1}+B${i}`)
        
        if (i % 10 === 0) {
          resultDiv.innerHTML = `â³ æ„å»ºåµŒå¥—å…¬å¼: ${i} / ${depth}\nå½“å‰ FPS: ${fps}`
          await new Promise(resolve => requestAnimationFrame(resolve))
        }
      }

      const buildTime = performance.now() - startTime

      // ç­‰å¾…æ‰€æœ‰è®¡ç®—å®Œæˆ
      resultDiv.innerHTML = `â³ ç­‰å¾…åµŒå¥—è®¡ç®—å®Œæˆ...\næ·±åº¦: ${depth} å±‚`
      const calcStart = performance.now()
      while (sheet.getQueueStats().pending > 0 || sheet.getQueueStats().processing > 0) {
        await new Promise(resolve => setTimeout(resolve, 50))
      }
      const calcTime = performance.now() - calcStart

      // éªŒè¯æœ€æ·±å±‚çš„ç»“æœ
      const deepestValue = sheet.getValueSync(depth, 1)

      clearInterval(fpsMonitor)

      const result = `
âœ… <strong>åµŒå¥—å…¬å¼æµ‹è¯•å®Œæˆ</strong>

<strong>æµ‹è¯•è§„æ¨¡ï¼š</strong>
  - åµŒå¥—æ·±åº¦: ${depth} å±‚
  - å…¬å¼æ•°é‡: ${depth * 2 + 2} ä¸ª
  - æœ€é•¿ä¾èµ–é“¾: ${depth + 1} çº§

<strong>æ„å»ºæ€§èƒ½ï¼š</strong>
  - æ„å»ºæ—¶é—´: <span class="metric fast">${buildTime.toFixed(2)} ms</span>
  - å¹³å‡æ—¶é—´: ${(buildTime / depth).toFixed(2)} ms/å±‚

<strong>è®¡ç®—æ€§èƒ½ï¼š</strong>
  - è®¡ç®—æ—¶é—´: <span class="metric ${calcTime < 500 ? 'fast' : calcTime < 2000 ? 'medium' : 'slow'}">${calcTime.toFixed(2)} ms</span>
  - é€’å½’æ·±åº¦: ${depth}
  - æœ€æ·±å±‚ç»“æœ: ${deepestValue}

<strong>UI æµç•…åº¦ï¼š</strong>
  - æœ€ä½ FPS: <span class="metric ${minFPS >= 55 ? 'fast' : minFPS >= 30 ? 'medium' : 'slow'}">${minFPS}</span>

<strong>åµŒå¥—è®¡ç®—ç»“è®ºï¼š</strong>
  ${typeof deepestValue === 'number' ? 'âœ… é€’å½’ä¾èµ–è®¡ç®—æ­£ç¡®' : 'âŒ åµŒå¥—è®¡ç®—å‡ºç°é”™è¯¯'}
  ${minFPS >= 55 ? '\nâœ… UI æµç•…åº¦ä¼˜ç§€' : minFPS >= 30 ? '\nâœ… UI åŸºæœ¬æµç•…' : '\nâš ï¸ UI æœ‰å¡é¡¿'}
`
      resultDiv.innerHTML = result
      disableAllButtons(false)
    }

    // æµ‹è¯• 4: æ··åˆå‹åŠ›æµ‹è¯•
    let test4Running = false

    window.test4 = async function() {
      if (test4Running) return

      test4Running = true
      disableAllButtons(true)
      document.getElementById('btn4-stop').disabled = false
      
      const resultDiv = document.getElementById('result4')
      resultDiv.innerHTML = 'â³ å¯åŠ¨æ··åˆå‹åŠ›æµ‹è¯•...'

      const model = new SheetModel()
      const sheet = new FormulaSheet(model, true)

      const startTime = performance.now()
      let operationCount = 0
      let minFPS = fps

      const fpsMonitor = setInterval(() => {
        if (fps < minFPS) minFPS = fps
      }, 100)

      while (test4Running && operationCount < 10000) {
        const row = Math.floor(Math.random() * 100)
        const col = Math.floor(Math.random() * 100)
        const operation = Math.random()

        if (operation < 0.5) {
          sheet.setValue(row, col, `=A${row + 1}+B${col + 1}`)
        } else if (operation < 0.8) {
          sheet.getValue(row, col)
        } else {
          sheet.setValue(row, col, '')
        }

        operationCount++

        if (operationCount % 100 === 0) {
          const stats = sheet.getQueueStats()
          const elapsed = (performance.now() - startTime) / 1000
          resultDiv.innerHTML = `
ğŸ”„ <strong>æ··åˆå‹åŠ›æµ‹è¯•è¿›è¡Œä¸­...</strong>

<strong>æ“ä½œç»Ÿè®¡ï¼š</strong>
  - å·²æ‰§è¡Œ: ${operationCount.toLocaleString()} æ¬¡æ“ä½œ
  - è¿è¡Œæ—¶é—´: ${elapsed.toFixed(1)} ç§’
  - æ“ä½œé€Ÿç‡: ${Math.round(operationCount / elapsed).toLocaleString()} æ¬¡/ç§’

<strong>é˜Ÿåˆ—çŠ¶æ€ï¼š</strong>
  - å¾…å¤„ç†: ${stats.pending} | å¤„ç†ä¸­: ${stats.processing}
  - å·²å®Œæˆ: ${stats.completed} | å¤±è´¥: ${stats.failed}

<strong>å½“å‰ FPSï¼š</strong> <span class="fps-meter">${fps}</span> (æœ€ä½: ${minFPS})

<span class="highlight">å°è¯•æ‹–åŠ¨ä¸Šæ–¹çš„æ»‘å—ï¼Œæµ‹è¯•UIå“åº”æ€§ï¼</span>
`
          await new Promise(resolve => requestAnimationFrame(resolve))
        }
      }

      const totalTime = (performance.now() - startTime) / 1000
      clearInterval(fpsMonitor)
      test4Running = false

      resultDiv.innerHTML = `
âœ… <strong>æ··åˆå‹åŠ›æµ‹è¯•å®Œæˆ</strong>

<strong>æµ‹è¯•ç»“æœï¼š</strong>
  - æ€»æ“ä½œæ•°: ${operationCount.toLocaleString()}
  - è¿è¡Œæ—¶é—´: ${totalTime.toFixed(2)} ç§’
  - å¹³å‡é€Ÿç‡: ${Math.round(operationCount / totalTime).toLocaleString()} æ“ä½œ/ç§’
  - é˜Ÿåˆ—å®Œæˆ: ${sheet.getQueueStats().completed.toLocaleString()} ä¸ªä»»åŠ¡

<strong>UI æµç•…åº¦ï¼š</strong>
  - æœ€ä½ FPS: <span class="metric ${minFPS >= 55 ? 'fast' : minFPS >= 30 ? 'medium' : 'slow'}">${minFPS}</span>

<strong>å‹åŠ›æµ‹è¯•ç»“è®ºï¼š</strong>
${minFPS >= 55 ? 'ğŸ‰ åœ¨é«˜è´Ÿè½½ä¸‹ UI ä¾ç„¶æµç•…ï¼' : minFPS >= 30 ? 'âœ… UI åŸºæœ¬ä¿æŒå“åº”' : 'âš ï¸ é«˜è´Ÿè½½å¯¹ UI æœ‰æ˜æ˜¾å½±å“'}
`
      disableAllButtons(false)
      document.getElementById('btn4-stop').disabled = true
    }

    window.stopTest4 = function() {
      test4Running = false
    }

    // æµ‹è¯• 5: å®Œæ•´æµ‹è¯•å¥—ä»¶
    window.test5 = async function() {
      disableAllButtons(true)
      const resultDiv = document.getElementById('result5')
      resultDiv.innerHTML = 'â³ è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶...\nè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´'

      const results = []

      // æµ‹è¯• 1: å°è§„æ¨¡å¼‚æ­¥
      resultDiv.innerHTML += '\n\nğŸ“ æµ‹è¯• 1/6: å°è§„æ¨¡å¼‚æ­¥ (1K)...'
      const t1Start = performance.now()
      const model1 = new SheetModel()
      const sheet1 = new FormulaSheet(model1, true)
      for (let i = 0; i < 1000; i++) {
        sheet1.setValue(Math.floor(i / 100), i % 100, `=A${i + 1}+B${i + 1}`)
      }
      while (sheet1.getQueueStats().pending > 0 || sheet1.getQueueStats().processing > 0) {
        await new Promise(resolve => setTimeout(resolve, 50))
      }
      const t1Time = performance.now() - t1Start
      results.push({ name: '1K å¼‚æ­¥', time: t1Time, rate: Math.round(1000 / (t1Time / 1000)) })

      // æµ‹è¯• 2: ä¸­è§„æ¨¡å¼‚æ­¥
      resultDiv.innerHTML += '\nğŸ“ æµ‹è¯• 2/6: ä¸­è§„æ¨¡å¼‚æ­¥ (10K)...'
      const t2Start = performance.now()
      const model2 = new SheetModel()
      const sheet2 = new FormulaSheet(model2, true)
      for (let i = 0; i < 10000; i++) {
        sheet2.setValue(Math.floor(i / 100), i % 100, `=A${i + 1}+B${i + 1}`)
        if ((i + 1) % 1000 === 0) await new Promise(resolve => requestAnimationFrame(resolve))
      }
      while (sheet2.getQueueStats().pending > 0 || sheet2.getQueueStats().processing > 0) {
        await new Promise(resolve => setTimeout(resolve, 50))
      }
      const t2Time = performance.now() - t2Start
      results.push({ name: '10K å¼‚æ­¥', time: t2Time, rate: Math.round(10000 / (t2Time / 1000)) })

      // æµ‹è¯• 3: å°è§„æ¨¡åŒæ­¥ï¼ˆå¯¹æ¯”ï¼‰
      resultDiv.innerHTML += '\nğŸ“ æµ‹è¯• 3/6: å°è§„æ¨¡åŒæ­¥ (1K)...'
      const t3Start = performance.now()
      const model3 = new SheetModel()
      const sheet3 = new FormulaSheet(model3, false)
      for (let i = 0; i < 1000; i++) {
        sheet3.setValue(Math.floor(i / 100), i % 100, `=A${i + 1}+B${i + 1}`)
        sheet3.getValueSync(Math.floor(i / 100), i % 100)
      }
      const t3Time = performance.now() - t3Start
      results.push({ name: '1K åŒæ­¥', time: t3Time, rate: Math.round(1000 / (t3Time / 1000)) })

      // æµ‹è¯• 4: åµŒå¥—å…¬å¼
      resultDiv.innerHTML += '\nğŸ“ æµ‹è¯• 4/6: åµŒå¥—å…¬å¼ (50å±‚)...'
      const t4Start = performance.now()
      const model4 = new SheetModel()
      const sheet4 = new FormulaSheet(model4, true)
      sheet4.setValue(0, 0, '1')
      sheet4.setValue(0, 1, '2')
      for (let i = 1; i <= 50; i++) {
        sheet4.setValue(i, 0, `=A${i}+1`)
        sheet4.setValue(i, 1, `=A${i + 1}+B${i}`)
      }
      while (sheet4.getQueueStats().pending > 0 || sheet4.getQueueStats().processing > 0) {
        await new Promise(resolve => setTimeout(resolve, 50))
      }
      const t4Time = performance.now() - t4Start
      results.push({ name: '50å±‚åµŒå¥—', time: t4Time, rate: Math.round(100 / (t4Time / 1000)) })

      // æµ‹è¯• 5: è¡Œåˆ—è°ƒæ•´
      resultDiv.innerHTML += '\nğŸ“ æµ‹è¯• 5/6: è¡Œåˆ—è°ƒæ•´ (1Kå…¬å¼/10è¡Œ)...'
      const t5Start = performance.now()
      const model5 = new SheetModel()
      const sheet5 = new FormulaSheet(model5, true)
      for (let i = 0; i < 1000; i++) {
        sheet5.setValue(Math.floor(i / 100), i % 100, `=A${i + 1}+B${i + 1}`)
      }
      while (sheet5.getQueueStats().pending > 0 || sheet5.getQueueStats().processing > 0) {
        await new Promise(resolve => setTimeout(resolve, 50))
      }
      const adjustStart = performance.now()
      for (let i = 0; i < 10; i++) {
        await sheet5.adjustAllFormulasAsync('insertRow', 0, 1)
      }
      const t5Time = performance.now() - adjustStart
      results.push({ name: 'æ’å…¥10è¡Œ', time: t5Time, rate: Math.round(10 / (t5Time / 1000)) })

      // æµ‹è¯• 6: æ··åˆæ“ä½œ
      resultDiv.innerHTML += '\nğŸ“ æµ‹è¯• 6/6: æ··åˆæ“ä½œ (1000æ¬¡)...'
      const t6Start = performance.now()
      const model6 = new SheetModel()
      const sheet6 = new FormulaSheet(model6, true)
      for (let i = 0; i < 1000; i++) {
        const row = Math.floor(Math.random() * 50)
        const col = Math.floor(Math.random() * 50)
        if (Math.random() < 0.7) {
          sheet6.setValue(row, col, `=A${row + 1}+B${col + 1}`)
        } else {
          sheet6.getValue(row, col)
        }
        if ((i + 1) % 100 === 0) await new Promise(resolve => requestAnimationFrame(resolve))
      }
      const t6Time = performance.now() - t6Start
      results.push({ name: 'æ··åˆ1000æ¬¡', time: t6Time, rate: Math.round(1000 / (t6Time / 1000)) })

      // ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
      const totalTime = results.reduce((sum, r) => sum + r.time, 0)
      const avgRate = Math.round(results.reduce((sum, r) => sum + r.rate, 0) / results.length)

      let tableHTML = '<table class="comparison-table"><thead><tr><th>æµ‹è¯•é¡¹</th><th>è€—æ—¶ (ms)</th><th>é€Ÿç‡</th><th>è¯„çº§</th></tr></thead><tbody>'
      results.forEach(r => {
        const rating = r.time < 1000 ? 'ğŸš€ ä¼˜ç§€' : r.time < 3000 ? 'âœ… è‰¯å¥½' : 'âš ï¸ ä¸€èˆ¬'
        tableHTML += `<tr><td>${r.name}</td><td>${r.time.toFixed(2)}</td><td>${r.rate.toLocaleString()}/ç§’</td><td>${rating}</td></tr>`
      })
      tableHTML += '</tbody></table>'

      resultDiv.innerHTML = `
âœ… <strong>å®Œæ•´æµ‹è¯•å¥—ä»¶å®Œæˆ</strong>

<strong>æµ‹è¯•æ±‡æ€»ï¼š</strong>
  - æµ‹è¯•é¡¹æ•°: 6 é¡¹
  - æ€»è€—æ—¶: <span class="metric">${totalTime.toFixed(2)} ms (${(totalTime / 1000).toFixed(2)}ç§’)</span>
  - å¹³å‡é€Ÿç‡: <span class="metric fast">${avgRate.toLocaleString()} æ“ä½œ/ç§’</span>

<strong>è¯¦ç»†ç»“æœï¼š</strong>
${tableHTML}

<strong>æ€§èƒ½å¯¹æ¯”åˆ†æï¼š</strong>
  - å¼‚æ­¥ vs åŒæ­¥ (1K): ${((results[2].time - results[0].time) / results[2].time * 100).toFixed(1)}% æ—¶é—´å·®å¼‚
  - 10K vs 1K æ‰©å±•æ€§: ${(results[1].time / results[0].time / 10).toFixed(2)}x (ç†æƒ³ä¸º 1.0x)
  - åµŒå¥—å…¬å¼æ•ˆç‡: ${results[3].rate} å…¬å¼/ç§’
  - è¡Œåˆ—è°ƒæ•´é€Ÿåº¦: ${(results[4].time / 10).toFixed(2)} ms/è¡Œ

<strong>æ€»ä½“è¯„ä»·ï¼š</strong>
  ${avgRate > 1000 ? 'ğŸ‰ æ€§èƒ½ä¼˜ç§€ï¼Œå®Œå…¨æ»¡è¶³ç”Ÿäº§ç¯å¢ƒéœ€æ±‚' : avgRate > 500 ? 'âœ… æ€§èƒ½è‰¯å¥½ï¼Œé€‚åˆä¸­ç­‰è§„æ¨¡åº”ç”¨' : 'âš ï¸ æ€§èƒ½ä¸€èˆ¬ï¼Œå»ºè®®ä¼˜åŒ–'}

<strong>ç³»ç»Ÿä¿¡æ¯ï¼š</strong>
  - æµè§ˆå™¨: ${document.getElementById('browserInfo').textContent}
  - CPU: ${document.getElementById('cpuInfo').textContent} æ ¸å¿ƒ
  - å…¨å±€ FPS èŒƒå›´: ${minFPSGlobal} - ${maxFPSGlobal}
`
      disableAllButtons(false)
    }

    // å¯¼å‡ºåˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä»¥ä¾¿ HTML å¯ä»¥è°ƒç”¨
    window.SheetModel = SheetModel
    window.FormulaSheet = FormulaSheet
  </script>
</body>
</html>
