<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº¤äº’å“åº”æ€§èƒ½æµ‹è¯• - WorkfineSheet</title>
  <style>
    :root { --primary: #fa709a; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f7fa; min-height: 100vh; }
    .navbar { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; padding: 16px 24px; display: flex; align-items: center; gap: 16px; }
    .navbar a { color: white; text-decoration: none; opacity: 0.8; }
    .navbar a:hover { opacity: 1; }
    .navbar h1 { font-size: 1.25rem; flex: 1; }
    .container { max-width: 1400px; margin: 0 auto; padding: 24px; }
    .intro { background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .intro h2 { color: #1f2937; margin-bottom: 12px; }
    .intro p { color: #6b7280; line-height: 1.6; }
    .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin: 20px 0; }
    .metric-card { background: #f9fafb; border-radius: 8px; padding: 16px; text-align: center; }
    .metric-card .value { font-size: 1.5rem; font-weight: 700; color: #ec4899; }
    .metric-card .label { font-size: 0.875rem; color: #6b7280; margin-top: 4px; }
    .test-section { background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .test-section h3 { color: #1f2937; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
    .test-section .desc { color: #6b7280; font-size: 0.9rem; margin-bottom: 16px; }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 16px; }
    button { padding: 10px 20px; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 500; transition: transform 0.2s, box-shadow 0.2s; }
    button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(250, 112, 154, 0.4); }
    button.secondary { background: #e5e7eb; color: #374151; }
    .result { background: #f9fafb; border-radius: 8px; padding: 16px; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85rem; line-height: 1.8; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
    .result:empty::before { content: 'ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...'; color: #9ca3af; }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }
    .badge.fast { background: #d1fae5; color: #065f46; }
    .badge.medium { background: #fef3c7; color: #92400e; }
    .badge.slow { background: #fee2e2; color: #991b1b; }
    .test-input { width: 300px; height: 40px; border: 2px solid #e5e7eb; border-radius: 8px; padding: 8px 12px; font-size: 1rem; margin-bottom: 16px; }
    .test-input:focus { outline: none; border-color: #fa709a; }
    .test-area { width: 100%; height: 200px; border: 2px solid #e5e7eb; border-radius: 8px; margin-bottom: 16px; cursor: crosshair; position: relative; background: #fafafa; overflow: hidden; }
    .cell-grid { display: grid; width: 100%; height: 100%; }
    .cell { border: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #666; transition: background-color 0.1s; }
    .cell:hover { background: #fff3cd; }
    .cell.selected { background: #d4edda; }
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="index.html">â† è¿”å›</a>
    <h1>âŒ¨ï¸ äº¤äº’å“åº”æ€§èƒ½æµ‹è¯•</h1>
  </nav>
  
  <div class="container">
    <div class="intro">
      <h2>äº¤äº’å“åº”æ€§èƒ½æµ‹è¯•</h2>
      <p>æµ‹è¯•ç”¨æˆ·äº¤äº’çš„å“åº”é€Ÿåº¦ï¼Œè¯„ä¼°æ•°æ®æ›´æ–°å»¶è¿Ÿã€æ‰¹é‡æ“ä½œå“åº”ç­‰ã€‚</p>
      
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="value" id="metricUpdateLatency">--</div>
          <div class="label">æ›´æ–°å»¶è¿Ÿ</div>
        </div>
        <div class="metric-card">
          <div class="value" id="metricBatchUpdate">--</div>
          <div class="label">æ‰¹é‡æ›´æ–°/ç§’</div>
        </div>
        <div class="metric-card">
          <div class="value" id="metricFormulaUpdate">--</div>
          <div class="label">å…¬å¼æ›´æ–°/ç§’</div>
        </div>
        <div class="metric-card">
          <div class="value" id="metricStyleUpdate">--</div>
          <div class="label">æ ·å¼æ›´æ–°/ç§’</div>
        </div>
      </div>
    </div>
    
    <!-- å•å…ƒæ ¼æ›´æ–°å»¶è¿Ÿ -->
    <div class="test-section">
      <h3>âŒ¨ï¸ æµ‹è¯• 1: å•å…ƒæ ¼æ›´æ–°å»¶è¿Ÿ</h3>
      <p class="desc">æµ‹é‡ä»è§¦å‘æ›´æ–°åˆ°æ•°æ®å†™å…¥å®Œæˆçš„æ—¶é—´</p>
      <div class="controls">
        <button onclick="testUpdateLatency(100)">100 æ¬¡æ›´æ–°</button>
        <button onclick="testUpdateLatency(1000)">1,000 æ¬¡æ›´æ–°</button>
        <button onclick="testUpdateLatency(5000)">5,000 æ¬¡æ›´æ–°</button>
      </div>
      <div id="result1" class="result"></div>
    </div>
    
    <!-- æ‰¹é‡æ•°æ®æ›´æ–° -->
    <div class="test-section">
      <h3>ğŸ“Š æµ‹è¯• 2: æ‰¹é‡æ•°æ®æ›´æ–°å“åº”</h3>
      <p class="desc">æµ‹è¯•è¿ç»­å¿«é€Ÿæ›´æ–°å¤šä¸ªå•å…ƒæ ¼çš„æ€§èƒ½</p>
      <div class="controls">
        <button onclick="testBatchUpdate(100)">100 å•å…ƒæ ¼</button>
        <button onclick="testBatchUpdate(500)">500 å•å…ƒæ ¼</button>
        <button onclick="testBatchUpdate(1000)">1,000 å•å…ƒæ ¼</button>
        <button onclick="testBatchUpdate(5000)">5,000 å•å…ƒæ ¼</button>
      </div>
      <div id="result2" class="result"></div>
    </div>
    
    <!-- å…¬å¼è”åŠ¨æ›´æ–° -->
    <div class="test-section">
      <h3>ğŸ“ æµ‹è¯• 3: å…¬å¼è”åŠ¨æ›´æ–°</h3>
      <p class="desc">æµ‹è¯•ä¿®æ”¹æºå•å…ƒæ ¼åå…¬å¼é‡ç®—çš„å“åº”æ—¶é—´</p>
      <div class="controls">
        <button onclick="testFormulaUpdate(10)">10 ä¸ªä¾èµ–å…¬å¼</button>
        <button onclick="testFormulaUpdate(50)">50 ä¸ªä¾èµ–å…¬å¼</button>
        <button onclick="testFormulaUpdate(100)">100 ä¸ªä¾èµ–å…¬å¼</button>
        <button onclick="testFormulaUpdate(500)">500 ä¸ªä¾èµ–å…¬å¼</button>
      </div>
      <div id="result3" class="result"></div>
    </div>
    
    <!-- æ ·å¼æ‰¹é‡æ›´æ–° -->
    <div class="test-section">
      <h3>ğŸ¨ æµ‹è¯• 4: æ ·å¼æ‰¹é‡æ›´æ–°</h3>
      <p class="desc">æµ‹è¯•è¿ç»­ä¿®æ”¹å•å…ƒæ ¼æ ·å¼çš„å“åº”æ—¶é—´</p>
      <div class="controls">
        <button onclick="testStyleUpdate(100)">100 å•å…ƒæ ¼</button>
        <button onclick="testStyleUpdate(500)">500 å•å…ƒæ ¼</button>
        <button onclick="testStyleUpdate(1000)">1,000 å•å…ƒæ ¼</button>
      </div>
      <div id="result4" class="result"></div>
    </div>
    
    <!-- é€‰åŒºæ“ä½œæ€§èƒ½ -->
    <div class="test-section">
      <h3>ğŸ–±ï¸ æµ‹è¯• 5: é€‰åŒºæ“ä½œæ€§èƒ½</h3>
      <p class="desc">æµ‹è¯•é€‰åŒºèŒƒå›´è®¡ç®—å’Œæ•°æ®è·å–çš„æ€§èƒ½</p>
      <div class="controls">
        <button onclick="testSelectionOps('small')">å°é€‰åŒº (10Ã—10)</button>
        <button onclick="testSelectionOps('medium')">ä¸­é€‰åŒº (50Ã—50)</button>
        <button onclick="testSelectionOps('large')">å¤§é€‰åŒº (100Ã—100)</button>
      </div>
      <div id="result5" class="result"></div>
    </div>
    
    <!-- ç»¼åˆäº¤äº’æµ‹è¯• -->
    <div class="test-section">
      <h3>ğŸ”„ æµ‹è¯• 6: ç»¼åˆäº¤äº’æµ‹è¯•</h3>
      <p class="desc">æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œåœºæ™¯çš„ç»¼åˆæ€§èƒ½</p>
      <div class="controls">
        <button onclick="testComprehensive()">è¿è¡Œç»¼åˆæµ‹è¯•</button>
      </div>
      <div id="result6" class="result"></div>
    </div>
  </div>

  <script type="module">
    import { SheetModel } from '../src/lib/SheetModel.ts'
    import { FormulaSheet } from '../src/lib/FormulaSheet.ts'
    
    function formatTime(ms) {
      if (ms < 0.001) return `${(ms * 1000000).toFixed(2)} ns`
      if (ms < 1) return `${(ms * 1000).toFixed(2)} Î¼s`
      if (ms < 1000) return `${ms.toFixed(2)} ms`
      return `${(ms / 1000).toFixed(2)} s`
    }
    
    function getSpeedClass(ms, thresholds) {
      if (ms < thresholds.fast) return 'fast'
      if (ms < thresholds.medium) return 'medium'
      return 'slow'
    }
    
    // æµ‹è¯• 1: å•å…ƒæ ¼æ›´æ–°å»¶è¿Ÿ
    window.testUpdateLatency = async function(count) {
      const resultDiv = document.getElementById('result1')
      resultDiv.innerHTML = 'â³ åˆ›å»ºæµ‹è¯•ç¯å¢ƒ...'
      
      await new Promise(r => setTimeout(r, 10))
      
      const model = new SheetModel()
      const latencies = []
      
      resultDiv.innerHTML = 'â³ æµ‹è¯•å•å…ƒæ ¼æ›´æ–°å»¶è¿Ÿ...'
      
      for (let i = 0; i < count; i++) {
        const start = performance.now()
        model.setValue(Math.floor(i / 100), i % 100, `Update-${i}`)
        latencies.push(performance.now() - start)
      }
      
      const avgLatency = latencies.reduce((a, b) => a + b, 0) / latencies.length
      const minLatency = Math.min(...latencies)
      const maxLatency = Math.max(...latencies)
      const p95Latency = latencies.sort((a, b) => a - b)[Math.floor(latencies.length * 0.95)]
      
      document.getElementById('metricUpdateLatency').textContent = formatTime(avgLatency)
      
      resultDiv.innerHTML = `
âœ… å•å…ƒæ ¼æ›´æ–°å»¶è¿Ÿæµ‹è¯•å®Œæˆ (çœŸå® SheetModel)

ğŸ“Š æµ‹è¯•è§„æ¨¡: ${count} æ¬¡æ›´æ–°

â±ï¸ å»¶è¿Ÿç»Ÿè®¡:
  â€¢ å¹³å‡å»¶è¿Ÿ: <span class="badge ${getSpeedClass(avgLatency, {fast: 0.01, medium: 0.1})}">${formatTime(avgLatency)}</span>
  â€¢ æœ€å°å»¶è¿Ÿ: ${formatTime(minLatency)}
  â€¢ æœ€å¤§å»¶è¿Ÿ: ${formatTime(maxLatency)}
  â€¢ P95 å»¶è¿Ÿ: <span class="badge ${getSpeedClass(p95Latency, {fast: 0.05, medium: 0.5})}">${formatTime(p95Latency)}</span>

ğŸ“ˆ æ€§èƒ½è¯„ä¼°:
  ${avgLatency < 0.01 ? 'ğŸš€ ä¼˜ç§€ - æ›´æ–°å“åº”å³æ—¶' : 
    avgLatency < 0.1 ? 'âœ… è‰¯å¥½ - æ›´æ–°å“åº”å¿«é€Ÿ' : 
    'âš ï¸ éœ€ä¼˜åŒ– - æ›´æ–°å“åº”è¾ƒæ…¢'}

ğŸ’¡ ç›®æ ‡: å•æ¬¡æ›´æ–° < 0.1ms
`
    }
    
    // æµ‹è¯• 2: æ‰¹é‡æ•°æ®æ›´æ–°
    window.testBatchUpdate = async function(count) {
      const resultDiv = document.getElementById('result2')
      resultDiv.innerHTML = 'â³ åˆ›å»ºæµ‹è¯•ç¯å¢ƒ...'
      
      await new Promise(r => setTimeout(r, 10))
      
      const model = new SheetModel()
      const rows = Math.ceil(Math.sqrt(count))
      const cols = Math.ceil(count / rows)
      
      // å…ˆå¡«å……åˆå§‹æ•°æ®
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          model.setValue(r, c, `Init-${r}-${c}`)
        }
      }
      
      resultDiv.innerHTML = 'â³ æµ‹è¯•æ‰¹é‡æ›´æ–°...'
      await new Promise(r => setTimeout(r, 10))
      
      // æµ‹è¯•æ‰¹é‡æ›´æ–°
      const start = performance.now()
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          model.setValue(r, c, `Updated-${r}-${c}`)
        }
      }
      const totalTime = performance.now() - start
      
      const updateRate = Math.round(count / (totalTime / 1000))
      document.getElementById('metricBatchUpdate').textContent = updateRate.toLocaleString()
      
      resultDiv.innerHTML = `
âœ… æ‰¹é‡æ•°æ®æ›´æ–°æµ‹è¯•å®Œæˆ (çœŸå® SheetModel)

ğŸ“Š æµ‹è¯•è§„æ¨¡: ${rows}Ã—${cols} = ${count} å•å…ƒæ ¼

â±ï¸ æ›´æ–°æ€§èƒ½:
  â€¢ æ€»æ—¶é—´: <span class="badge ${getSpeedClass(totalTime, {fast: 50, medium: 200})}">${formatTime(totalTime)}</span>
  â€¢ å¹³å‡æ¯å•å…ƒæ ¼: ${formatTime(totalTime / count)}
  â€¢ æ›´æ–°é€Ÿç‡: <span class="badge fast">${updateRate.toLocaleString()} å•å…ƒæ ¼/ç§’</span>

ğŸ“ˆ æ€§èƒ½è¯„ä¼°:
  ${totalTime / count < 0.01 ? 'ğŸš€ ä¼˜ç§€ - æ‰¹é‡æ›´æ–°æå¿«' : 
    totalTime / count < 0.1 ? 'âœ… è‰¯å¥½ - æ‰¹é‡æ›´æ–°æ­£å¸¸' : 
    'âš ï¸ éœ€ä¼˜åŒ– - æ‰¹é‡æ›´æ–°è¾ƒæ…¢'}
`
    }
    
    // æµ‹è¯• 3: å…¬å¼è”åŠ¨æ›´æ–°
    window.testFormulaUpdate = async function(count) {
      const resultDiv = document.getElementById('result3')
      resultDiv.innerHTML = 'â³ åˆ›å»ºå…¬å¼ä¾èµ–ç½‘ç»œ...'
      
      await new Promise(r => setTimeout(r, 10))
      
      const model = new SheetModel()
      const sheet = new FormulaSheet(model)
      
      // è®¾ç½®æºå•å…ƒæ ¼
      model.setValue(0, 0, 100)
      
      // åˆ›å»ºä¾èµ– A1 çš„å…¬å¼
      for (let i = 0; i < count; i++) {
        const r = Math.floor(i / 50) + 1
        const c = i % 50
        sheet.setValue(r, c, '=A1*2')
      }
      
      resultDiv.innerHTML = 'â³ æµ‹è¯•å…¬å¼è”åŠ¨æ›´æ–°...'
      await new Promise(r => setTimeout(r, 10))
      
      // æµ‹è¯•æ›´æ–°æºå•å…ƒæ ¼è§¦å‘çš„å…¬å¼é‡ç®—
      const iterations = 10
      const times = []
      
      for (let i = 0; i < iterations; i++) {
        const start = performance.now()
        sheet.setValue(0, 0, 100 + i)
        
        // è¯»å–æ‰€æœ‰ä¾èµ–å…¬å¼çš„å€¼ï¼ˆè§¦å‘é‡ç®—ï¼‰
        for (let j = 0; j < count; j++) {
          const r = Math.floor(j / 50) + 1
          const c = j % 50
          sheet.getValue(r, c)
        }
        
        times.push(performance.now() - start)
      }
      
      const avgTime = times.reduce((a, b) => a + b, 0) / times.length
      const updateRate = Math.round(count / (avgTime / 1000))
      
      document.getElementById('metricFormulaUpdate').textContent = updateRate.toLocaleString()
      
      resultDiv.innerHTML = `
âœ… å…¬å¼è”åŠ¨æ›´æ–°æµ‹è¯•å®Œæˆ (çœŸå® FormulaSheet)

ğŸ“Š æµ‹è¯•è§„æ¨¡: ${count} ä¸ªä¾èµ–å…¬å¼

â±ï¸ è”åŠ¨æ›´æ–°æ€§èƒ½:
  â€¢ å¹³å‡æ›´æ–°æ—¶é—´: <span class="badge ${getSpeedClass(avgTime, {fast: 50, medium: 200})}">${formatTime(avgTime)}</span>
  â€¢ æ¯å…¬å¼é‡ç®—æ—¶é—´: ${formatTime(avgTime / count)}
  â€¢ å…¬å¼æ›´æ–°é€Ÿç‡: <span class="badge fast">${updateRate.toLocaleString()} å…¬å¼/ç§’</span>

ğŸ“ˆ æ€§èƒ½è¯„ä¼°:
  ${avgTime / count < 0.1 ? 'ğŸš€ ä¼˜ç§€ - å…¬å¼è”åŠ¨æå¿«' : 
    avgTime / count < 1 ? 'âœ… è‰¯å¥½ - å…¬å¼è”åŠ¨æ­£å¸¸' : 
    'âš ï¸ éœ€ä¼˜åŒ– - å…¬å¼è”åŠ¨è¾ƒæ…¢'}

ğŸ’¡ è¯´æ˜:
  â€¢ ä¿®æ”¹ A1 è§¦å‘æ‰€æœ‰ä¾èµ–å…¬å¼é‡æ–°è®¡ç®—
  â€¢ FormulaSheet ä½¿ç”¨ç¼“å­˜ä¼˜åŒ–é‡å¤è®¡ç®—
`
    }
    
    // æµ‹è¯• 4: æ ·å¼æ‰¹é‡æ›´æ–°
    window.testStyleUpdate = async function(count) {
      const resultDiv = document.getElementById('result4')
      resultDiv.innerHTML = 'â³ åˆ›å»ºæµ‹è¯•ç¯å¢ƒ...'
      
      await new Promise(r => setTimeout(r, 10))
      
      const model = new SheetModel()
      const rows = Math.ceil(Math.sqrt(count))
      const cols = Math.ceil(count / rows)
      
      // å…ˆå¡«å……æ•°æ®
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          model.setValue(r, c, `Cell-${r}-${c}`)
        }
      }
      
      resultDiv.innerHTML = 'â³ æµ‹è¯•æ ·å¼æ›´æ–°...'
      await new Promise(r => setTimeout(r, 10))
      
      const styles = [
        { bgColor: '#ffcccc' },
        { bgColor: '#ccffcc' },
        { bgColor: '#ccccff' },
        { fontWeight: 'bold' },
        { fontStyle: 'italic' }
      ]
      
      const start = performance.now()
      let styleIndex = 0
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          model.setCellStyle(r, c, styles[styleIndex % styles.length])
          styleIndex++
        }
      }
      const totalTime = performance.now() - start
      
      const updateRate = Math.round(count / (totalTime / 1000))
      document.getElementById('metricStyleUpdate').textContent = updateRate.toLocaleString()
      
      resultDiv.innerHTML = `
âœ… æ ·å¼æ‰¹é‡æ›´æ–°æµ‹è¯•å®Œæˆ (çœŸå® SheetModel)

ğŸ“Š æµ‹è¯•è§„æ¨¡: ${count} å•å…ƒæ ¼

â±ï¸ æ ·å¼æ›´æ–°æ€§èƒ½:
  â€¢ æ€»æ—¶é—´: <span class="badge ${getSpeedClass(totalTime, {fast: 50, medium: 200})}">${formatTime(totalTime)}</span>
  â€¢ å¹³å‡æ¯å•å…ƒæ ¼: ${formatTime(totalTime / count)}
  â€¢ æ›´æ–°é€Ÿç‡: <span class="badge fast">${updateRate.toLocaleString()} å•å…ƒæ ¼/ç§’</span>

ğŸ“ˆ æ€§èƒ½è¯„ä¼°:
  ${totalTime / count < 0.05 ? 'ğŸš€ ä¼˜ç§€ - æ ·å¼æ›´æ–°æå¿«' : 
    totalTime / count < 0.2 ? 'âœ… è‰¯å¥½ - æ ·å¼æ›´æ–°æ­£å¸¸' : 
    'âš ï¸ éœ€ä¼˜åŒ– - æ ·å¼æ›´æ–°è¾ƒæ…¢'}
`
    }
    
    // æµ‹è¯• 5: é€‰åŒºæ“ä½œæ€§èƒ½
    window.testSelectionOps = async function(size) {
      const resultDiv = document.getElementById('result5')
      const sizes = { small: 10, medium: 50, large: 100 }
      const dim = sizes[size]
      const cellCount = dim * dim
      
      resultDiv.innerHTML = 'â³ åˆ›å»ºæµ‹è¯•æ•°æ®...'
      await new Promise(r => setTimeout(r, 10))
      
      const model = new SheetModel()
      
      // å¡«å……æ•°æ®
      for (let r = 0; r < dim; r++) {
        for (let c = 0; c < dim; c++) {
          model.setValue(r, c, `R${r}C${c}`)
        }
      }
      
      resultDiv.innerHTML = 'â³ æµ‹è¯•é€‰åŒºæ“ä½œ...'
      await new Promise(r => setTimeout(r, 10))
      
      // æµ‹è¯•è·å–é€‰åŒºæ•°æ®
      const iterations = 50
      const readTimes = []
      
      for (let i = 0; i < iterations; i++) {
        const start = performance.now()
        
        // æ¨¡æ‹Ÿè·å–é€‰åŒºå†…æ‰€æœ‰å•å…ƒæ ¼æ•°æ®
        const data = []
        for (let r = 0; r < dim; r++) {
          const row = []
          for (let c = 0; c < dim; c++) {
            row.push(model.getValue(r, c))
          }
          data.push(row)
        }
        
        readTimes.push(performance.now() - start)
      }
      
      const avgReadTime = readTimes.reduce((a, b) => a + b, 0) / readTimes.length
      const readRate = Math.round(cellCount / (avgReadTime / 1000))
      
      resultDiv.innerHTML = `
âœ… é€‰åŒºæ“ä½œæ€§èƒ½æµ‹è¯•å®Œæˆ (çœŸå® SheetModel)

ğŸ“Š é€‰åŒºè§„æ¨¡: ${dim}Ã—${dim} = ${cellCount.toLocaleString()} å•å…ƒæ ¼

â±ï¸ é€‰åŒºè¯»å–æ€§èƒ½:
  â€¢ å¹³å‡è¯»å–æ—¶é—´: <span class="badge ${getSpeedClass(avgReadTime, {fast: 10, medium: 50})}">${formatTime(avgReadTime)}</span>
  â€¢ æ¯å•å…ƒæ ¼è¯»å–: ${formatTime(avgReadTime / cellCount)}
  â€¢ è¯»å–é€Ÿç‡: <span class="badge fast">${readRate.toLocaleString()} å•å…ƒæ ¼/ç§’</span>

ğŸ“ˆ æ€§èƒ½è¯„ä¼°:
  ${avgReadTime < 10 ? 'ğŸš€ ä¼˜ç§€ - é€‰åŒºæ“ä½œæå¿«' : 
    avgReadTime < 50 ? 'âœ… è‰¯å¥½ - é€‰åŒºæ“ä½œæ­£å¸¸' : 
    'âš ï¸ éœ€ä¼˜åŒ– - é€‰åŒºæ“ä½œè¾ƒæ…¢'}

ğŸ’¡ è¯´æ˜:
  â€¢ é€‰åŒºæ“ä½œå¸¸ç”¨äºå¤åˆ¶ã€ç²˜è´´ã€æ‰¹é‡è®¾ç½®æ ·å¼
  â€¢ å¤§é€‰åŒºè¯»å–æ€§èƒ½å½±å“ç”¨æˆ·ä½“éªŒ
`
    }
    
    // æµ‹è¯• 6: ç»¼åˆäº¤äº’æµ‹è¯•
    window.testComprehensive = async function() {
      const resultDiv = document.getElementById('result6')
      resultDiv.innerHTML = 'â³ è¿è¡Œç»¼åˆäº¤äº’æµ‹è¯•...'
      
      await new Promise(r => setTimeout(r, 10))
      
      const model = new SheetModel()
      const sheet = new FormulaSheet(model)
      
      const results = {}
      
      // 1. åˆå§‹æ•°æ®å¡«å……
      let start = performance.now()
      for (let r = 0; r < 100; r++) {
        for (let c = 0; c < 50; c++) {
          model.setValue(r, c, r * 50 + c)
        }
      }
      results.fillData = performance.now() - start
      
      // 2. æ·»åŠ å…¬å¼
      start = performance.now()
      for (let r = 0; r < 20; r++) {
        for (let c = 0; c < 10; c++) {
          sheet.setValue(r + 100, c, `=SUM(A${r + 1}:J${r + 1})`)
        }
      }
      results.addFormulas = performance.now() - start
      
      // 3. è®¾ç½®æ ·å¼
      start = performance.now()
      for (let r = 0; r < 50; r++) {
        for (let c = 0; c < 25; c++) {
          model.setCellStyle(r, c, { bgColor: '#f0f0f0', fontWeight: 'bold' })
        }
      }
      results.setStyles = performance.now() - start
      
      // 4. ä¿®æ”¹æ•°æ®è§¦å‘å…¬å¼é‡ç®—
      start = performance.now()
      for (let i = 0; i < 10; i++) {
        model.setValue(i, 0, i * 100)
        // è¯»å–ä¾èµ–çš„å…¬å¼å€¼
        for (let r = 0; r < 20; r++) {
          sheet.getValue(r + 100, 0)
        }
      }
      results.updateWithRecalc = performance.now() - start
      
      // 5. æ‰¹é‡è¯»å–
      start = performance.now()
      for (let r = 0; r < 100; r++) {
        for (let c = 0; c < 50; c++) {
          model.getValue(r, c)
          model.getCellStyle(r, c)
        }
      }
      results.batchRead = performance.now() - start
      
      const totalTime = Object.values(results).reduce((a, b) => a + b, 0)
      
      resultDiv.innerHTML = `
âœ… ç»¼åˆäº¤äº’æµ‹è¯•å®Œæˆ (çœŸå® SheetModel + FormulaSheet)

ğŸ“Š æµ‹è¯•åœºæ™¯æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œ:

â±ï¸ å„é˜¶æ®µè€—æ—¶:
  â€¢ åˆå§‹æ•°æ®å¡«å…… (5000 å•å…ƒæ ¼): <span class="badge ${getSpeedClass(results.fillData, {fast: 50, medium: 200})}">${formatTime(results.fillData)}</span>
  â€¢ æ·»åŠ å…¬å¼ (200 ä¸ª): <span class="badge ${getSpeedClass(results.addFormulas, {fast: 100, medium: 500})}">${formatTime(results.addFormulas)}</span>
  â€¢ è®¾ç½®æ ·å¼ (1250 å•å…ƒæ ¼): <span class="badge ${getSpeedClass(results.setStyles, {fast: 50, medium: 200})}">${formatTime(results.setStyles)}</span>
  â€¢ æ•°æ®æ›´æ–°+å…¬å¼é‡ç®—: <span class="badge ${getSpeedClass(results.updateWithRecalc, {fast: 50, medium: 200})}">${formatTime(results.updateWithRecalc)}</span>
  â€¢ æ‰¹é‡è¯»å– (5000 å•å…ƒæ ¼): <span class="badge ${getSpeedClass(results.batchRead, {fast: 50, medium: 200})}">${formatTime(results.batchRead)}</span>

ğŸ“ˆ æ€»ä½“è¯„ä¼°:
  â€¢ æ€»è€—æ—¶: <span class="badge ${getSpeedClass(totalTime, {fast: 300, medium: 1000})}">${formatTime(totalTime)}</span>
  ${totalTime < 300 ? 'ğŸš€ ä¼˜ç§€ - ç»¼åˆæ€§èƒ½æä½³ï¼Œç”¨æˆ·ä½“éªŒæµç•…' : 
    totalTime < 1000 ? 'âœ… è‰¯å¥½ - ç»¼åˆæ€§èƒ½æ­£å¸¸ï¼ŒåŸºæœ¬æµç•…' : 
    'âš ï¸ éœ€ä¼˜åŒ– - éƒ¨åˆ†æ“ä½œå¯èƒ½æœ‰å»¶è¿Ÿæ„Ÿ'}

ğŸ’¡ è¯´æ˜:
  â€¢ æµ‹è¯•è¦†ç›–äº†å¸¸è§çš„è¡¨æ ¼æ“ä½œåœºæ™¯
  â€¢ åŒ…å«æ•°æ®è¯»å†™ã€å…¬å¼è®¡ç®—ã€æ ·å¼è®¾ç½®ç­‰ç»¼åˆæ“ä½œ
`
    }
  </script>
</body>
</html>
