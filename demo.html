<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WorkfineSheet æ¼”ç¤º</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f7fa;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .header h1 {
      font-size: 1.25rem;
      flex: 1;
    }
    
    .header a {
      color: white;
      text-decoration: none;
      opacity: 0.8;
      font-size: 0.9rem;
    }
    
    .header a:hover {
      opacity: 1;
    }
    
    .toolbar {
      background: white;
      padding: 12px 24px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .toolbar button {
      padding: 8px 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .toolbar button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    .toolbar button.secondary {
      background: #e5e7eb;
      color: #374151;
    }
    
    .toolbar button.secondary:hover {
      background: #d1d5db;
      box-shadow: none;
    }
    
    .toolbar .divider {
      width: 1px;
      height: 24px;
      background: #e5e7eb;
    }
    
    .toolbar .info {
      color: #6b7280;
      font-size: 0.875rem;
    }
    
    .sheet-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .sheet-container {
      flex: 1;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      min-height: 600px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ“Š WorkfineSheet æ¼”ç¤º</h1>
    <a href="tests/index.html">æ€§èƒ½æµ‹è¯• â†’</a>
  </div>
  
  <div class="toolbar">
    <button onclick="loadDemoData()">ğŸ“‹ åŠ è½½ç¤ºä¾‹æ•°æ®</button>
    <button onclick="clearData()" class="secondary">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
    <div class="divider"></div>
    <button onclick="addSheet()" class="secondary">â• æ–°å»ºå·¥ä½œè¡¨</button>
    <div class="divider"></div>
    <span class="info" id="statusInfo">å°±ç»ª</span>
  </div>
  
  <div class="sheet-wrapper">
    <div id="sheet-container" class="sheet-container"></div>
  </div>
  
  <script type="module">
    import { Workbook } from './src/lib/Workbook.js'
    import { initializeDemoData } from './src/lib/demoData.js'
    import { createApp, h, ref, nextTick, shallowRef } from 'vue'
    import WorkbookSheet from './src/components/WorkbookSheet.vue'
    
    // å…¨å±€ Workbook å®ä¾‹
    let workbookInstance = null
    let app = null
    let workbookRef = null
    
    // æ›´æ–°çŠ¶æ€ä¿¡æ¯
    function updateStatus(message) {
      document.getElementById('statusInfo').textContent = message
    }
    
    // åˆå§‹åŒ–è¡¨æ ¼
    function initSheet() {
      workbookInstance = new Workbook()
      
      const container = document.getElementById('sheet-container')
      container.innerHTML = ''
      
      // ä½¿ç”¨ shallowRef é¿å…æ·±åº¦å“åº”å¼
      workbookRef = shallowRef(workbookInstance)
      
      app = createApp({
        setup() {
          return () => h(WorkbookSheet, {
            workbook: workbookRef.value,
            style: { width: '100%', height: '100%' }
          })
        }
      })
      
      app.mount(container)
      updateStatus('è¡¨æ ¼å·²åˆå§‹åŒ–')
    }
    
    // åŠ è½½ç¤ºä¾‹æ•°æ®
    function loadDemoData() {
      // åˆ›å»ºæ–°çš„ workbook å¹¶åŠ è½½ç¤ºä¾‹æ•°æ®
      workbookInstance = new Workbook()
      initializeDemoData(workbookInstance)
      
      // é‡æ–°æŒ‚è½½ç»„ä»¶
      if (app) {
        app.unmount()
      }
      
      const container = document.getElementById('sheet-container')
      container.innerHTML = ''
      
      workbookRef = shallowRef(workbookInstance)
      
      app = createApp({
        setup() {
          return () => h(WorkbookSheet, {
            workbook: workbookRef.value,
            style: { width: '100%', height: '100%' }
          })
        }
      })
      
      app.mount(container)
      updateStatus('ç¤ºä¾‹æ•°æ®å·²åŠ è½½ - åŒ…å«æ ·å¼ç¤ºä¾‹å’Œæ ¼å¼ç¤ºä¾‹ä¸¤ä¸ªå·¥ä½œè¡¨')
    }
    
    // æ¸…ç©ºæ•°æ®
    function clearData() {
      if (app) {
        app.unmount()
      }
      workbookInstance = null
      initSheet()
      updateStatus('æ•°æ®å·²æ¸…ç©º')
    }
    
    // æ–°å»ºå·¥ä½œè¡¨
    function addSheet() {
      if (!workbookInstance) {
        initSheet()
      }
      
      const count = workbookInstance.getSheetCount() + 1
      const sheetId = workbookInstance.addSheet(`Sheet${count}`)
      workbookInstance.setActiveSheet(sheetId)
      
      // é‡æ–°æ¸²æŸ“
      if (app) {
        app.unmount()
      }
      
      const container = document.getElementById('sheet-container')
      container.innerHTML = ''
      
      workbookRef = shallowRef(workbookInstance)
      
      app = createApp({
        setup() {
          return () => h(WorkbookSheet, {
            workbook: workbookRef.value,
            style: { width: '100%', height: '100%' }
          })
        }
      })
      
      app.mount(container)
      updateStatus(`å·²æ·»åŠ æ–°å·¥ä½œè¡¨: Sheet${count}`)
    }
    
    // æš´éœ²åˆ°å…¨å±€
    window.loadDemoData = loadDemoData
    window.clearData = clearData
    window.addSheet = addSheet
    
    // åˆå§‹åŒ–
    initSheet()
  </script>
</body>
</html>
