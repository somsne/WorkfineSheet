# 🧪 快速测试指南

**目的**: 验证 Phase 2 集成是否工作正常  
**时间**: ~5 分钟  
**要求**: 浏览器 + 应用运行中

---

## 🎬 快速开始

### 1. 打开应用 (✅ 已运行)

```
URL: http://localhost:5174/
```

✅ 开发服务器已在运行

### 2. 查看初始数据

应该看到一个表格:

```
        Item    Q1      Q2      Total
Sales           100     150     [?]
Profit          20      30      [?]
Margin          [?]     [?]     [?]
```

---

## 📋 快速测试

### Test 1: 基础公式计算 (2 分钟)

**步骤**:
1. 打开应用
2. 查看 D2 单元格 (Total 列第一行)

**预期结果**:
- [ ] D2 显示 **250** (不是 "=B2+C2")

**实际结果**: ________

**状态**: ✅ / ❌

---

### Test 2: 编辑模式显示 (1 分钟)

**步骤**:
1. 双击 D2 单元格
2. 观察编辑框

**预期结果**:
- [ ] 编辑框显示 **=B2+C2** (原始公式)
- [ ] 编辑框有**红色边框**
- [ ] 背景是**浅红色** (#fef2f2)

**实际结果**: ________

**状态**: ✅ / ❌

---

### Test 3: 单元格引用插入 (2 分钟)

**步骤**:
1. 编辑框仍打开
2. 清空内容，输入 "="
3. 点击单元格 B1

**预期结果**:
- [ ] 编辑框显示 **=B1**
- [ ] 编辑框保持打开状态
- [ ] 仍可以继续输入

**实际结果**: ________

**状态**: ✅ / ❌

---

### Test 4: 范围选择 (1 分钟)

**步骤**:
1. 清空编辑框，输入 "=SUM("
2. 点击 B2
3. 按住鼠标拖到 B3
4. 释放鼠标

**预期结果**:
- [ ] 编辑框显示 **=SUM(B2:B3**
- [ ] 范围格式为 A1:B2 的形式
- [ ] 可以继续输入 ")"

**实际结果**: ________

**状态**: ✅ / ❌

---

## 🐛 问题排查

### 如果公式未计算 (显示 "=B2+C2" 而不是 250)

**可能原因**:
1. FormulaSheet 初始化失败
2. getValue() 未被调用
3. hot-formula-parser 库未加载

**排查步骤**:
```javascript
// 在浏览器控制台输入:
console.log(document.querySelector('canvas'))  // 应该有两个 canvas
```

### 如果编辑框没有红色边框

**可能原因**:
1. formulaMode 未正确检测
2. 样式未应用

**排查步骤**:
```javascript
// 在浏览器控制台查看:
// 双击单元格，按 F12 打开控制台
// 查看 Elements 标签中 input 的 style
```

### 如果单元格引用未插入

**可能原因**:
1. overlayInput.value 为 null
2. insertCellReference() 未被暴露
3. onMouseUp 中的条件不满足

**排查步骤**:
```javascript
// 在编辑框中输入 "="，然后打开控制台
// 输入: document.querySelectorAll('input')[0].value
// 应该看到 "="
```

---

## ✅ 验收标准

### Green (可以继续)
- [ ] D2、D3 显示计算结果
- [ ] 编辑框显示原始公式
- [ ] 编辑框有正确的样式
- [ ] 可以点击单元格插入引用
- [ ] 拖动可以选择范围

### Yellow (需要修复但不阻塞)
- [ ] 样式不完全正确
- [ ] 某些公式未计算
- [ ] 控制台有警告

### Red (需要立即修复)
- [ ] 应用崩溃或白屏
- [ ] 编辑框无法打开
- [ ] 所有公式都未计算

---

## 📞 调试命令

### 在浏览器控制台运行

```javascript
// 检查 FormulaSheet 是否初始化
window.__formulaSheet  // 应该是 FormulaSheet 实例

// 检查模型数据
window.__model.getValue(0, 0)  // 应该返回 "Item"
window.__model.getValue(1, 3)  // 应该返回 "=B2+C2"

// 测试公式计算
const engine = new FormulaEngine((r, c) => {
  const vals = [
    ['Item', 'Q1', 'Q2', 'Total'],
    ['Sales', 100, 150, '=B2+C2'],
    ['Profit', 20, 30, '=B3+C3']
  ]
  return vals[r]?.[c]
})
engine.evaluate('=100+150')  // 应该返回 {result: 250, error: null}
```

---

## 📱 截图对比

### 预期的正确状态

```
表格显示 (无编辑模式):
┌─────────┬────┬────┬───────┐
│ Item    │ Q1 │ Q2 │ Total │
├─────────┼────┼────┼───────┤
│ Sales   │100 │150 │ 250   │  ✅ 显示计算结果
├─────────┼────┼────┼───────┤
│ Profit  │ 20 │ 30 │  50   │  ✅ 显示计算结果
├─────────┼────┼────┼───────┤
│ Margin  │ 20 │ 20 │  20   │  ✅ 显示计算结果
└─────────┴────┴────┴───────┘

编辑模式 (双击 D2):
┌──────────────────────┐
│ =B2+C2               │  ✅ 红色边框
│                      │  ✅ 浅红背景
└──────────────────────┘

公式编辑中 (输入 "="):
┌──────────────────────┐
│ =B1                  │  ✅ 点击 B1 后插入
│ =B1+C2               │  ✅ 继续编辑
│ =SUM(B2:B3)          │  ✅ 拖动选择范围
└──────────────────────┘
```

---

## 🎯 成功指标

**如果你看到了这些，Phase 2 就成功了!** ✅

- [ ] D2、D3 显示数字而不是公式
- [ ] 编辑框有红色边框
- [ ] 可以在公式中点击其他单元格
- [ ] 拖动可以选择范围
- [ ] 浏览器控制台无红色错误

---

## 📞 获取帮助

### 查看完整文档
- PHASE2_COMPLETE.md - 详细的实现说明
- FORMULA_PLAN.md - 整体规划
- FORMULA_PROGRESS.md - 进度追踪

### 查看代码
- src/components/CanvasSheet.vue - 主集成点
- src/components/SheetOverlayInput.vue - 编辑框增强
- src/lib/FormulaSheet.ts - 公式层包装
- src/lib/FormulaEngine.ts - 计算引擎

---

**现在就开始测试吧！** 🚀

预计 5 分钟内就能验证所有基础功能。
